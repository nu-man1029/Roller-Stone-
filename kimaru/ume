<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KIMARU | 提案書ビルダー</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;600&family=Noto+Serif+JP:wght@300;400;600&family=Lato:wght@300;400&display=swap');

        :root {
            --gold: #D4AF37;
            --gold-light: #e8cc6a;
            --gold-dim: rgba(212,175,55,0.3);
            --dark: #0a0a0a;
            --dark-2: #141414;
            --dark-3: #1e1e1e;
            --dark-4: #2a2a2a;
            --text: #f0f0f0;
            --text-muted: #888;
            --border: #2e2e2e;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Lato', 'Noto Serif JP', serif;
            background: var(--dark);
            color: var(--text);
            min-height: 100vh;
            padding-bottom: 60px;
        }

        .editor {
            position: sticky; top: 0; z-index: 200;
            background: var(--dark-2);
            border-bottom: 1px solid var(--gold-dim);
            box-shadow: 0 8px 40px rgba(0,0,0,0.9);
            max-height: 90vh; overflow-y: auto;
        }

        .editor-inner { max-width: 960px; margin: 0 auto; padding: 20px 24px; }

        .editor-header {
            display: flex; align-items: center; justify-content: space-between;
            margin-bottom: 18px; padding-bottom: 14px;
            border-bottom: 1px solid var(--border);
        }

        .editor-logo {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.4rem; font-weight: 300;
            letter-spacing: 8px; color: var(--gold);
        }

        .mode-toggle { display: flex; border: 1px solid var(--border); border-radius: 4px; overflow: hidden; }

        .mode-btn {
            background: var(--dark-3); border: none; color: var(--text-muted);
            padding: 8px 16px; font-size: 0.72rem; letter-spacing: 2px;
            cursor: pointer; transition: all 0.2s;
        }
        .mode-btn.active { background: var(--gold); color: #000; font-weight: 700; }

        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }
        @media (max-width: 620px) { .form-grid { grid-template-columns: 1fr; } }

        .form-group { display: flex; flex-direction: column; gap: 6px; }
        .form-group.full { grid-column: 1 / -1; }

        label {
            font-size: 0.65rem; color: var(--gold);
            letter-spacing: 2px; font-weight: 700; text-transform: uppercase;
        }

        input[type="text"], input[type="url"], textarea {
            background: var(--dark-4); border: 1px solid var(--border);
            border-radius: 3px; color: var(--text);
            padding: 10px 12px; font-size: 0.88rem;
            font-family: inherit; outline: none;
            transition: border-color 0.2s; width: 100%;
        }
        input[type="text"]:focus, input[type="url"]:focus, textarea:focus { border-color: var(--gold-dim); }
        textarea { resize: vertical; line-height: 1.6; }

        .file-upload-label {
            display: block; background: var(--dark-4);
            border: 1px dashed #444; border-radius: 3px;
            padding: 10px 12px; font-size: 0.75rem;
            color: var(--text-muted); cursor: pointer;
            text-align: center; transition: border-color 0.2s, color 0.2s;
        }
        .file-upload-label:hover { border-color: var(--gold); color: var(--gold); }
        .file-upload-label input { display: none; }
        .file-upload-label.has-file { border-color: var(--gold-dim); color: var(--gold-light); }

        /* BA SETS */
        .ba-sets-container { grid-column: 1 / -1; }

        .ba-set {
            background: var(--dark-3); border: 1px solid var(--border);
            border-radius: 4px; padding: 16px; margin-bottom: 12px;
        }

        .ba-set-header {
            display: flex; align-items: center; justify-content: space-between;
            margin-bottom: 12px; padding-bottom: 10px;
            border-bottom: 1px solid var(--border);
        }

        .ba-set-title { font-size: 0.65rem; color: var(--gold); letter-spacing: 2px; font-weight: 700; }

        .btn-remove-ba {
            background: none; border: 1px solid #444; color: #666;
            padding: 4px 10px; font-size: 0.65rem;
            cursor: pointer; border-radius: 3px; letter-spacing: 1px;
        }
        .btn-remove-ba:hover { border-color: #c0392b; color: #c0392b; }

        .ba-set-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 8px; }

        .ba-sub-label {
            font-size: 0.6rem; color: var(--text-muted);
            letter-spacing: 2px; margin: 12px 0 8px;
            text-transform: uppercase;
            border-top: 1px solid var(--border); padding-top: 12px;
        }

        .spec-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 8px; }
        .spec-grid input { font-size: 0.82rem; padding: 8px 10px; }

        .btn-add-ba {
            width: 100%; background: none; border: 1px dashed #444;
            color: var(--text-muted); padding: 10px; font-size: 0.75rem;
            cursor: pointer; border-radius: 3px; letter-spacing: 2px;
            transition: all 0.2s; margin-top: 4px;
        }
        .btn-add-ba:hover { border-color: var(--gold); color: var(--gold); }

        .btn-publish {
            grid-column: 1 / -1;
            background: linear-gradient(90deg, #B8860B, #D4AF37, #B8860B);
            background-size: 200%; color: #000; border: none;
            padding: 16px; font-size: 0.85rem; font-weight: 700;
            letter-spacing: 4px; cursor: pointer; border-radius: 3px;
            margin-top: 8px; transition: background-position 0.4s; text-transform: uppercase;
        }
        .btn-publish:hover { background-position: right; }

        #preview-wrap { max-width: 1040px; margin: 28px auto; padding: 0 16px; }
        .preview-label { font-size: 0.65rem; color: var(--text-muted); letter-spacing: 3px; margin-bottom: 8px; text-transform: uppercase; }
        #output-iframe { width: 100%; height: 880px; border: 1px solid var(--border); border-radius: 4px; display: block; }
    </style>
</head>
<body>

<div class="editor">
    <div class="editor-inner">
        <div class="editor-header">
            <div class="editor-logo">KIMARU</div>
            <div class="mode-toggle">
                <button class="mode-btn active" id="btn-dark" onclick="setMode('dark',this)">DARK</button>
                <button class="mode-btn" id="btn-light" onclick="setMode('light',this)">LIGHT</button>
            </div>
        </div>

        <div class="form-grid">
            <div class="form-group">
                <label>Project Title</label>
                <input type="text" id="title" value="M-RESIDENCE EXTERIOR PLAN" oninput="updatePreview()">
            </div>
            <div class="form-group">
                <label>LINE お問い合わせ URL</label>
                <input type="url" id="line-url" placeholder="https://lin.ee/xxxxxxx" oninput="updatePreview()">
            </div>
            <div class="form-group full">
                <label>Catch Copy（別チャットで生成してここに貼付）</label>
                <input type="text" id="catch" placeholder="例：歳月を重ねるほどに深まる、石積みの品格。" oninput="updatePreview()">
            </div>
            <div class="form-group full">
                <label>Main Visual</label>
                <label class="file-upload-label" id="label-hero">
                    ＋ メインビジュアルをアップロード
                    <input type="file" accept="image/*" onchange="processImg(this,'hero','label-hero')">
                </label>
            </div>

            <div class="form-group ba-sets-container">
                <label>Before / After セット（最大5組）</label>
                <div id="ba-sets"></div>
                <button class="btn-add-ba" id="btn-add-ba" onclick="addBASet()">＋ Before / After セットを追加</button>
            </div>

            <div class="form-group full">
                <label>Design Concept（別チャットで生成してここに貼付）</label>
                <textarea id="comment" rows="3" placeholder="例：邸宅の価値を再定義する、特別な提案です。" oninput="updatePreview()"></textarea>
            </div>
            <div class="form-group full">
                <label>Last Visual（俯瞰 / 夜景）</label>
                <label class="file-upload-label" id="label-footer_img">
                    ＋ フッタービジュアルをアップロード
                    <input type="file" accept="image/*" onchange="processImg(this,'footer_img','label-footer_img')">
                </label>
            </div>

            <button class="btn-publish" onclick="preparePublish()">公開用 HTML を生成 → ダウンロード</button>
        </div>
    </div>
</div>

<div id="preview-wrap">
    <div class="preview-label">▸ LIVE PREVIEW</div>
    <iframe id="output-iframe"></iframe>
</div>

<script>
const images = { hero: '', footer_img: '' };
let baSets = [];
let baCounter = 0;
let currentMode = 'dark';
const ANALYTICS_ID = 'G-9KY5C7XC36';

function setMode(mode, btn) {
    currentMode = mode;
    document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    updatePreview();
}

function compressImage(file, callback) {
    const reader = new FileReader();
    reader.onload = (e) => {
        const img = new Image();
        img.onload = () => {
            const MAX = 1200;
            let w = img.width, h = img.height;
            if (w > MAX || h > MAX) {
                if (w > h) { h = Math.round(h * MAX / w); w = MAX; }
                else       { w = Math.round(w * MAX / h); h = MAX; }
            }
            const canvas = document.createElement('canvas');
            canvas.width = w; canvas.height = h;
            canvas.getContext('2d').drawImage(img, 0, 0, w, h);
            callback(canvas.toDataURL('image/jpeg', 0.72));
        };
        img.src = e.target.result;
    };
    reader.readAsDataURL(file);
}

function processImg(input, key, labelId) {
    if (!input.files[0]) return;
    compressImage(input.files[0], (b64) => {
        const m = key.match(/^(b|a|ref)_(\d+)$/);
        if (m) {
            const [, type, id] = m;
            const set = baSets.find(s => s.id == id);
            if (set) {
                if (type === 'b')   set.before = b64;
                if (type === 'a')   set.after  = b64;
                if (type === 'ref') set.refImg = b64;
            }
        } else {
            images[key] = b64;
        }
        const lbl = document.getElementById(labelId);
        if (lbl) {
            lbl.classList.add('has-file');
            lbl.childNodes[0].textContent = '✔ ' + input.files[0].name.substring(0, 28);
        }
        updatePreview();
    });
}

function addBASet() {
    if (baSets.length >= 5) { alert('Before/Afterセットは最大5組までです。'); return; }
    const id = ++baCounter;
    baSets.push({ id, before:'', after:'', refImg:'', sectionTitle:'', comment:'', matType:'', matSize:'', matColor:'', matGrout:'' });
    renderBASets();
    updatePreview();
}

function removeBASet(id) {
    baSets = baSets.filter(s => s.id !== id);
    renderBASets();
    updatePreview();
}

function esc(str) { return (str || '').replace(/"/g, '&quot;'); }

function renderBASets() {
    const container = document.getElementById('ba-sets');
    container.innerHTML = '';
    baSets.forEach((set, idx) => {
        const div = document.createElement('div');
        div.className = 'ba-set';
        div.innerHTML = `
            <div class="ba-set-header">
                <span class="ba-set-title">SET ${String(idx+1).padStart(2,'0')}</span>
                ${baSets.length > 1 ? `<button class="btn-remove-ba" onclick="removeBASet(${set.id})">削除</button>` : ''}
            </div>

            <input type="text" placeholder="セクションタイトル（例：床ローラーストーン・正形タイル調）"
                value="${esc(set.sectionTitle)}"
                oninput="baSets.find(s=>s.id==${set.id}).sectionTitle=this.value; updatePreview();">

            <div class="ba-set-grid" style="margin-top:8px;">
                <label class="file-upload-label" id="label-b_${set.id}">
                    ＋ BEFORE
                    <input type="file" accept="image/*" onchange="processImg(this,'b_${set.id}','label-b_${set.id}')">
                </label>
                <label class="file-upload-label" id="label-a_${set.id}">
                    ＋ AFTER
                    <input type="file" accept="image/*" onchange="processImg(this,'a_${set.id}','label-a_${set.id}')">
                </label>
            </div>

            <input type="text" placeholder="スライダー下コメント（例：外壁と階段を統一感ある仕上げに）"
                value="${esc(set.comment)}"
                oninput="baSets.find(s=>s.id==${set.id}).comment=this.value; updatePreview();"
                style="margin-top:8px;">

            <div class="ba-sub-label">仕上がり参考画像 ＋ 仕様詳細</div>

            <label class="file-upload-label" id="label-ref_${set.id}">
                ＋ 仕上がり参考画像をアップロード
                <input type="file" accept="image/*" onchange="processImg(this,'ref_${set.id}','label-ref_${set.id}')">
            </label>

            <div class="spec-grid">
                <input type="text" placeholder="タイル種類（例：タイル調）"
                    value="${esc(set.matType)}"
                    oninput="baSets.find(s=>s.id==${set.id}).matType=this.value; updatePreview();">
                <input type="text" placeholder="サイズ（例：約30cm角）"
                    value="${esc(set.matSize)}"
                    oninput="baSets.find(s=>s.id==${set.id}).matSize=this.value; updatePreview();">
                <input type="text" placeholder="仕上げカラー（例：グレー色）"
                    value="${esc(set.matColor)}"
                    oninput="baSets.find(s=>s.id==${set.id}).matColor=this.value; updatePreview();">
                <input type="text" placeholder="目地カラー（例：ブラック）"
                    value="${esc(set.matGrout)}"
                    oninput="baSets.find(s=>s.id==${set.id}).matGrout=this.value; updatePreview();">
            </div>
        `;
        container.appendChild(div);
    });
    const addBtn = document.getElementById('btn-add-ba');
    if (addBtn) addBtn.style.display = baSets.length >= 5 ? 'none' : 'block';
}

function generateHTML() {
    const title    = document.getElementById('title').value || 'PROPOSAL';
    const catchTxt = document.getElementById('catch').value || '';
    const comment  = document.getElementById('comment').value || '';
    const lineUrl  = document.getElementById('line-url').value || '';
    const isDark   = currentMode === 'dark';

    const ph = (w,h,t) => `https://via.placeholder.com/${w}x${h}/111/2a2a2a?text=${encodeURIComponent(t)}`;
    const imgHero   = images.hero       || ph(1600,900,'MAIN VISUAL');
    const imgFooter = images.footer_img || ph(1600,700,'LAST VISUAL');

    const theme = isDark ? `
        --bg:#060606; --bg2:#0f0f0f; --bg3:#181818;
        --text:#f0ece4; --muted:#777;
        --gold:#D4AF37; --gold2:#c9a84c;
        --border:rgba(212,175,55,0.18);
        --ref-bg:rgba(255,255,255,0.02);
    ` : `
        --bg:#f8f5ef; --bg2:#eeebe3; --bg3:#e4e0d6;
        --text:#1a1512; --muted:#888;
        --gold:#8a6e1e; --gold2:#a07f2a;
        --border:rgba(138,110,30,0.25);
        --ref-bg:rgba(0,0,0,0.03);
    `;

    const baSectionsHTML = baSets.map((set, idx) => {
        const bImg = set.before || ph(1200,675,`BEFORE ${idx+1}`);
        const aImg = set.after  || ph(1200,675,`AFTER ${idx+1}`);

        const specRows = [
            set.matType  ? `<tr><td class="spec-key">タイル種類</td><td class="spec-val">${set.matType}</td></tr>` : '',
            set.matSize  ? `<tr><td class="spec-key">サイズ</td><td class="spec-val">${set.matSize}</td></tr>` : '',
            set.matColor ? `<tr><td class="spec-key">仕上げカラー</td><td class="spec-val">${set.matColor}</td></tr>` : '',
            set.matGrout ? `<tr><td class="spec-key">目地カラー</td><td class="spec-val">${set.matGrout}</td></tr>` : '',
        ].join('');

        const hasRef = set.refImg || specRows;
        const refBlock = hasRef ? `
        <div class="ref-block">
            ${set.refImg ? `<img src="${set.refImg}" class="ref-img" alt="仕上がり参考">` : ''}
            ${specRows ? `<div class="spec-wrap"><div class="spec-title">仕上がり参考</div><table class="spec-table">${specRows}</table></div>` : ''}
        </div>` : '';

        return `
        <div class="section-divider">
            <span class="section-num">${String(idx+1).padStart(2,'0')}</span>
            <span class="section-label-txt">${set.sectionTitle || 'Perspective Comparison'}</span>
        </div>
        <div class="ba-container" id="ba-${idx}">
            <img src="${bImg}" class="ba-img ba-before" alt="Before">
            <img src="${aImg}" class="ba-img ba-after" alt="After">
            <div class="ba-handle">
                <div class="ba-handle-line"></div>
                <div class="ba-handle-pill">SLIDE</div>
            </div>
            <div class="ba-labels">
                <span class="ba-label-tag">BEFORE</span>
                <span class="ba-label-tag after-tag">AFTER</span>
            </div>
        </div>
        ${set.comment ? `<div class="ba-comment">${set.comment}</div>` : ''}
        ${refBlock}`;
    }).join('');

    const lineButtonHTML = lineUrl ? `
        <div class="line-cta-wrap">
            <a href="${lineUrl}" class="line-cta-btn" target="_blank" rel="noopener">
                <svg width="22" height="22" viewBox="0 0 40 38" fill="currentColor" style="margin-right:10px;flex-shrink:0;"><path d="M20 0C9 0 0 7.2 0 16c0 5.5 3.4 10.3 8.7 13.3-.4 1.4-1.4 5.1-1.6 5.9-.2 1 .4 1 .8.7.3-.2 4.8-3.3 6.7-4.6.9.1 1.9.2 2.9.2 11 0 20-7.2 20-16S31 0 20 0z"/></svg>
                LINE でお問い合わせ
            </a>
        </div>` : '';

    return `<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>${title}</title>
<script async src="https://www.googletagmanager.com/gtag/js?id=${ANALYTICS_ID}"><\/script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js',new Date());gtag('config','${ANALYTICS_ID}');<\/script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;600&family=Noto+Serif+JP:wght@300;400;600&display=swap" rel="stylesheet">
<style>
:root { ${theme} }
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0;}
body{background:var(--bg);color:var(--text);font-family:'Noto Serif JP','Cormorant Garamond',serif;overflow-x:hidden;}

@keyframes kenburns{
    0%  { transform: scale(1.08) translate(1%, 1%); }
    100%{ transform: scale(1.0)  translate(0%,  0%); }
}
@keyframes hero-fade{
    0%  { opacity:0; transform: translateY(22px); }
    100%{ opacity:1; transform: translateY(0); }
}
@keyframes catch-in{
    0%  { opacity:0; letter-spacing:10px; }
    100%{ opacity:.9; letter-spacing:4px; }
}

.hero{position:relative;height:100vh;min-height:600px;display:flex;align-items:flex-end;justify-content:flex-start;overflow:hidden;}
.hero-bg{
    position:absolute;inset:0;
    background:url('${imgHero}') center/cover no-repeat;
    animation: kenburns 10s ease-out forwards;
    transform-origin: center center;
    will-change: transform;
}
.hero::after{content:'';position:absolute;inset:0;background:linear-gradient(to top,rgba(0,0,0,0.88) 0%,rgba(0,0,0,0.08) 60%);z-index:1;}
.hero-content{position:relative;z-index:10;padding:60px 7%;max-width:800px;}
.hero-catch{
    font-family:'Cormorant Garamond',serif;font-size:clamp(1rem,2vw,1.15rem);
    font-weight:300;color:var(--gold);margin-bottom:18px;
    animation: catch-in 1.6s cubic-bezier(0.22,1,0.36,1) 0.4s both;
}
.hero-title{
    font-family:'Cormorant Garamond',serif;font-size:clamp(2rem,5vw,3.4rem);
    font-weight:300;letter-spacing:10px;line-height:1.2;color:#fff;text-transform:uppercase;
    border-top:1px solid rgba(212,175,55,.4);padding-top:18px;
    animation: hero-fade 1.4s cubic-bezier(0.22,1,0.36,1) 0.9s both;
}

.section-divider{display:flex;align-items:baseline;gap:16px;width:88%;max-width:960px;margin:90px auto 32px;padding-bottom:12px;border-bottom:1px solid var(--border);}
.section-num{font-family:'Cormorant Garamond',serif;font-size:3rem;font-weight:300;color:var(--gold);line-height:1;opacity:.6;}
.section-label-txt{font-size:.9rem;letter-spacing:3px;color:var(--text);font-weight:300;}

.ba-container{position:relative;width:88%;max-width:960px;margin:0 auto;aspect-ratio:16/9;overflow:hidden;border:1px solid var(--border);cursor:ew-resize;user-select:none;}
.ba-img{position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;pointer-events:none;}
.ba-after{clip-path:inset(0 50% 0 0);z-index:2;}
.ba-handle{position:absolute;top:0;bottom:0;left:50%;transform:translateX(-50%);width:44px;z-index:10;display:flex;flex-direction:column;align-items:center;pointer-events:none;}
.ba-handle-line{width:2px;flex:1;background:var(--gold);}
.ba-handle-pill{background:var(--gold);color:#000;font-size:.55rem;letter-spacing:2px;padding:6px 10px;white-space:nowrap;font-weight:700;}
.ba-labels{position:absolute;bottom:14px;left:0;right:0;display:flex;justify-content:space-between;padding:0 18px;z-index:5;pointer-events:none;}
.ba-label-tag{background:rgba(0,0,0,.6);color:#ccc;font-size:.7rem;letter-spacing:3px;padding:5px 12px;border:1px solid rgba(255,255,255,.15);}
.after-tag{background:rgba(0,0,0,.7);color:var(--gold);border-color:var(--gold);}

.ba-comment{width:88%;max-width:960px;margin:16px auto 0;font-size:1rem;color:var(--muted);letter-spacing:1px;padding-left:20px;border-left:2px solid var(--border);line-height:1.8;}

.ref-block{display:flex;align-items:flex-start;gap:32px;width:88%;max-width:960px;margin:28px auto 0;padding:28px 32px;border:1px solid var(--border);background:var(--ref-bg);}
@media(max-width:600px){.ref-block{flex-direction:column;}}
.ref-img{width:220px;min-width:140px;aspect-ratio:4/3;object-fit:cover;border:1px solid var(--border);flex-shrink:0;}
.spec-wrap{flex:1;}
.spec-title{font-size:.65rem;letter-spacing:5px;color:var(--gold);text-transform:uppercase;margin-bottom:16px;}
.spec-table{border-collapse:collapse;width:100%;}
.spec-table tr{border-bottom:1px solid var(--border);}
.spec-key{font-size:.85rem;color:var(--muted);padding:12px 16px 12px 0;white-space:nowrap;vertical-align:top;width:40%;}
.spec-val{font-size:1rem;color:var(--text);padding:12px 0;font-weight:300;letter-spacing:1px;}

.concept-wrap{width:88%;max-width:860px;margin:100px auto;padding:50px 60px;border:1px solid var(--border);position:relative;}
.concept-wrap::before{content:'CONCEPT';position:absolute;top:-.55em;left:40px;background:var(--bg);color:var(--gold);font-size:.65rem;letter-spacing:6px;padding:0 10px;}
.concept-text{font-size:clamp(1rem,1.8vw,1.15rem);line-height:2.6;color:var(--text);font-weight:300;}

.line-cta-wrap{text-align:center;margin:80px auto 40px;}
.line-cta-btn{display:inline-flex;align-items:center;justify-content:center;background:#06C755;color:#fff;text-decoration:none;padding:20px 50px;font-size:1.05rem;letter-spacing:3px;font-family:'Noto Serif JP',serif;border-radius:2px;transition:opacity .2s;min-width:300px;}
.line-cta-btn:hover{opacity:.85;}

.last-visual-wrap{margin-top:80px;width:100%;overflow:hidden;}
.last-visual{width:100%;display:block;filter:${isDark ? 'contrast(1.08) brightness(0.9)' : 'contrast(1.05) brightness(1.0)'};}

footer{padding:80px 0 60px;text-align:center;background:${isDark ? '#040404' : '#e0dbd0'};border-top:1px solid var(--border);}
.footer-brand{font-family:'Cormorant Garamond',serif;font-size:1.6rem;font-weight:300;letter-spacing:12px;color:var(--gold);margin-bottom:16px;}
.footer-sub{font-size:.7rem;letter-spacing:4px;color:var(--muted);text-transform:uppercase;}
</style>
</head>
<body>

<div class="hero">
    <div class="hero-bg"></div>
    <div class="hero-content">
        ${catchTxt ? `<div class="hero-catch">${catchTxt}</div>` : ''}
        <h1 class="hero-title">${title}</h1>
    </div>
</div>

${baSectionsHTML}

${comment ? `<div class="concept-wrap"><p class="concept-text">${comment.replace(/\n/g,'<br>')}</p></div>` : ''}

${lineButtonHTML}

<div class="last-visual-wrap"><img src="${imgFooter}" class="last-visual" alt="Detail"></div>

<footer>
    <div class="footer-brand">ROLLER STONE</div>
    <div class="footer-sub">Premium Exterior Presentation</div>
</footer>

<script>
document.querySelectorAll('.ba-container').forEach(function(container){
    var handle=container.querySelector('.ba-handle');
    var afterImg=container.querySelector('.ba-after');
    var dragging=false;
    function update(clientX){
        var rect=container.getBoundingClientRect();
        var pos=Math.max(0,Math.min(100,((clientX-rect.left)/rect.width)*100));
        afterImg.style.clipPath='inset(0 '+(100-pos)+'% 0 0)';
        handle.style.left=pos+'%';
        handle.style.transform='translateX(-50%)';
    }
    container.addEventListener('mousedown',function(e){dragging=true;update(e.clientX);});
    window.addEventListener('mousemove',function(e){if(dragging)update(e.clientX);});
    window.addEventListener('mouseup',function(){dragging=false;});
    container.addEventListener('touchstart',function(e){update(e.touches[0].clientX);},{passive:true});
    container.addEventListener('touchmove',function(e){update(e.touches[0].clientX);},{passive:true});
});
<\/script>
</body>
</html>`;
}

function updatePreview() {
    const iframe = document.getElementById('output-iframe');
    const doc = iframe.contentWindow.document;
    doc.open(); doc.write(generateHTML()); doc.close();
}

function preparePublish() {
    const html = generateHTML();
    const blob = new Blob([html], { type: 'text/html' });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'index.html';
    a.click();
    setTimeout(() => {
        alert('index.html を保存しました。\nGitHub のリポジトリにドラッグ＆ドロップしてアップロードしてください。');
    }, 300);
}

window.onload = function() {
    addBASet();
    updatePreview();
};
</script>
</body>
</html>
