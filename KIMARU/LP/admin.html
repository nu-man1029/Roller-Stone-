<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>KIMARU ç®¡ç†ç”»é¢</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500&family=Cormorant+Garamond:wght@300;400&display=swap" rel="stylesheet">
<style>
*{box-sizing:border-box;margin:0;padding:0;}
:root{
  --gold:#c9a84c;--bg:#0e0e0e;--bg2:#161616;--bg3:#1e1e1e;
  --border:rgba(201,168,76,0.18);--text:#eeebe4;--text2:#888;
  --radius:10px;--green:#4caf7d;--red:#e05555;
}
body{background:var(--bg);color:var(--text);font-family:'Noto Sans JP',sans-serif;font-weight:300;min-height:100vh;}
.header{background:var(--bg2);border-bottom:1px solid var(--border);padding:18px 28px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:100;}
.header-logo{font-family:'Cormorant Garamond',serif;font-size:1.4rem;color:var(--gold);letter-spacing:4px;}
.header-logo span{color:var(--text2);font-size:.72rem;letter-spacing:2px;margin-left:10px;font-family:'Noto Sans JP',sans-serif;}
.hbtns{display:flex;gap:10px;}
.btn{font-family:'Noto Sans JP',sans-serif;font-size:.78rem;font-weight:400;letter-spacing:1px;padding:10px 22px;border-radius:6px;cursor:pointer;border:none;transition:all .2s;display:flex;align-items:center;gap:7px;}
.btn-primary{background:var(--gold);color:#111;}
.btn-primary:hover{opacity:.85;transform:translateY(-1px);}
.btn-secondary{background:transparent;color:var(--text2);border:1px solid var(--border);}
.btn-secondary:hover{border-color:var(--gold);color:var(--gold);}
.btn-danger{background:transparent;color:var(--red);border:1px solid rgba(224,85,85,.3);font-size:.72rem;padding:7px 14px;}
.btn-danger:hover{background:rgba(224,85,85,.1);}
.btn-add{background:rgba(201,168,76,.08);color:var(--gold);border:1px dashed rgba(201,168,76,.4);width:100%;padding:14px;border-radius:8px;font-size:.82rem;letter-spacing:1px;margin-top:16px;}
.btn-add:hover{background:rgba(201,168,76,.14);}

/* LAYOUT */
.layout{display:grid;grid-template-columns:210px 1fr;min-height:calc(100vh - 61px);}
.sidebar{background:var(--bg2);border-right:1px solid var(--border);padding:20px 0;}
.sidebar-label{font-size:.6rem;letter-spacing:3px;color:var(--text2);padding:14px 14px 6px;text-transform:uppercase;}
.nav-item{display:flex;align-items:center;gap:9px;padding:9px 14px;border-radius:6px;cursor:pointer;font-size:.8rem;color:var(--text2);transition:all .2s;border:none;background:none;width:100%;text-align:left;}
.nav-item:hover{background:var(--bg3);color:var(--text);}
.nav-item.active{background:rgba(201,168,76,.1);color:var(--gold);border-left:2px solid var(--gold);}
.main{padding:36px 40px 120px;}
.page{display:none;}.page.active{display:block;}
.page-title{font-family:'Cormorant Garamond',serif;font-size:1.7rem;font-weight:300;color:var(--text);margin-bottom:4px;letter-spacing:2px;}
.page-sub{font-size:.78rem;color:var(--text2);margin-bottom:32px;}

/* CARDS */
.card{background:var(--bg2);border:1px solid var(--border);border-radius:var(--radius);margin-bottom:20px;overflow:hidden;}
.card-head{padding:16px 22px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:10px;}
.card-icon{font-size:1rem;}
.card-name{font-size:.88rem;font-weight:500;letter-spacing:.5px;}
.card-desc{font-size:.72rem;color:var(--text2);margin-left:auto;}
.card-body{padding:22px;}

/* BA SLIDER CARD */
.ba-card{background:var(--bg2);border:1px solid var(--border);border-radius:var(--radius);margin-bottom:16px;overflow:hidden;}
.ba-card-head{padding:14px 18px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:10px;}
.ba-card-num{font-family:'Cormorant Garamond',serif;font-size:1.4rem;color:var(--gold);opacity:.5;line-height:1;}
.ba-card-title-input{flex:1;background:transparent;border:none;color:var(--text);font-family:'Noto Sans JP',sans-serif;font-size:.88rem;outline:none;border-bottom:1px solid transparent;transition:border-color .2s;padding:2px 4px;}
.ba-card-title-input:focus{border-bottom-color:var(--gold);}
.ba-card-body{padding:18px;}
.ba-img-grid{display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-bottom:16px;}
.img-drop-label{font-size:.65rem;letter-spacing:2px;color:var(--text2);margin-bottom:7px;text-transform:uppercase;}
.img-drop{border:2px dashed var(--border);border-radius:8px;overflow:hidden;aspect-ratio:16/9;display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;transition:all .2s;position:relative;background:var(--bg3);}
.img-drop:hover{border-color:var(--gold);}
.img-drop.has-img{border-style:solid;border-color:rgba(201,168,76,.4);}
.img-drop img.preview{width:100%;height:100%;object-fit:cover;position:absolute;top:0;left:0;}
.img-drop-overlay{position:absolute;inset:0;background:rgba(0,0,0,.55);display:flex;flex-direction:column;align-items:center;justify-content:center;opacity:0;transition:opacity .2s;z-index:1;}
.img-drop:hover .img-drop-overlay,.img-drop:not(.has-img) .img-drop-overlay{opacity:1;}
.img-drop-icon{font-size:1.6rem;margin-bottom:5px;color:var(--gold);}
.img-drop-text{font-size:.68rem;color:var(--text2);text-align:center;}
.img-drop input[type=file]{display:none;}
.img-fname{font-size:.68rem;color:var(--text2);margin-top:5px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}

/* INFO FIELDS */
.info-fields{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;margin-bottom:14px;}
.sample-row{display:flex;align-items:center;gap:14px;}
.sample-preview-wrap{position:relative;width:64px;height:64px;flex-shrink:0;}
.sample-preview{width:64px;height:64px;border-radius:7px;object-fit:cover;border:1px solid var(--border);display:none;}
.sample-preview.visible{display:block;}

/* FORM */
label.field-label{display:block;font-size:.65rem;letter-spacing:2px;color:var(--text2);margin-bottom:7px;text-transform:uppercase;}
input[type=text],input[type=url],textarea{width:100%;background:var(--bg3);border:1px solid var(--border);border-radius:6px;padding:11px 13px;color:var(--text);font-family:'Noto Sans JP',sans-serif;font-size:.85rem;font-weight:300;outline:none;transition:border-color .2s;}
input[type=text]:focus,input[type=url]:focus,textarea:focus{border-color:var(--gold);}
textarea{resize:vertical;line-height:1.9;}
.hint{font-size:.68rem;color:var(--text2);margin-top:5px;line-height:1.7;}
.hint a{color:var(--gold);text-decoration:none;}
.form-row{margin-bottom:18px;}.form-row:last-child{margin-bottom:0;}
.form-grid{display:grid;grid-template-columns:1fr 1fr;gap:14px;}
.form-grid3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:14px;}

/* TOGGLE */
.toggle-row{display:flex;align-items:center;justify-content:space-between;padding:12px 0;border-bottom:1px solid rgba(255,255,255,.04);}
.toggle-row:last-child{border-bottom:none;}
.toggle-info .t-label{font-size:.83rem;font-weight:400;}
.toggle-info .t-desc{font-size:.7rem;color:var(--text2);margin-top:2px;}
.toggle{position:relative;width:42px;height:22px;flex-shrink:0;margin-left:14px;}
.toggle input{display:none;}
.toggle-track{display:block;width:100%;height:100%;background:var(--bg3);border:1px solid var(--border);border-radius:11px;transition:all .2s;cursor:pointer;}
.toggle input:checked+.toggle-track{background:rgba(201,168,76,.3);border-color:var(--gold);}
.toggle-thumb{position:absolute;top:3px;left:3px;width:14px;height:14px;background:var(--text2);border-radius:50%;transition:all .2s;pointer-events:none;}
.toggle input:checked~.toggle-thumb{left:23px;background:var(--gold);}

/* LOGO GRID */
.logo-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:14px;}
.logo-drop{border:2px dashed var(--border);border-radius:8px;aspect-ratio:1;overflow:hidden;display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;transition:all .2s;position:relative;background:var(--bg3);}
.logo-drop:hover{border-color:var(--gold);}
.logo-drop.has-img{border-style:solid;border-color:rgba(201,168,76,.4);}
.logo-drop img.preview{width:100%;height:100%;object-fit:cover;position:absolute;}
.logo-drop input[type=file]{display:none;}

/* SAVE BAR */
.save-bar{position:fixed;bottom:0;left:0;right:0;background:var(--bg2);border-top:1px solid var(--border);padding:14px 28px;display:flex;align-items:center;justify-content:space-between;transform:translateY(100%);transition:transform .3s;z-index:200;}
.save-bar.show{transform:translateY(0);}
.save-msg{font-size:.78rem;color:var(--text2);}
.save-msg strong{color:var(--gold);}
.save-btns{display:flex;gap:10px;}

/* TOAST */
.toast{position:fixed;top:72px;right:20px;background:var(--bg2);border:1px solid var(--green);border-radius:8px;padding:12px 18px;font-size:.8rem;color:var(--text);display:flex;align-items:center;gap:9px;transform:translateX(120%);transition:transform .3s;z-index:300;}
.toast.show{transform:translateX(0);}

/* BA PREVIEW */
.ba-preview-panel{background:var(--bg3);border-radius:8px;overflow:hidden;margin-bottom:8px;}
.ba-preview-slider{position:relative;width:100%;aspect-ratio:16/9;cursor:ew-resize;user-select:none;}
.ba-preview-img{position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;}
.ba-preview-after{clip-path:inset(0 0 0 50%);z-index:2;}
.ba-preview-handle{position:absolute;top:0;bottom:0;left:50%;transform:translateX(-50%);width:30px;z-index:10;display:flex;flex-direction:column;align-items:center;pointer-events:none;}
.ba-preview-line{width:2px;flex:1;background:var(--gold);}
.ba-preview-pill{background:var(--gold);color:#111;font-size:.5rem;font-weight:700;letter-spacing:2px;padding:4px 6px;}
.ba-preview-empty{display:flex;align-items:center;justify-content:center;height:120px;color:var(--text2);font-size:.78rem;}

@media(max-width:768px){
  .layout{grid-template-columns:1fr;}
  .sidebar{display:none;}
  .main{padding:20px 14px 120px;}
  .form-grid,.form-grid3,.info-fields,.ba-img-grid,.logo-grid{grid-template-columns:1fr;}
}
</style>
</head>
<body>

<header class="header">
  <div class="header-logo">KIMARU <span>ç®¡ç†ç”»é¢</span></div>
  <div class="hbtns">
    <button class="btn btn-secondary" onclick="previewLP()">ğŸ‘ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</button>
    <button class="btn btn-primary" onclick="generateAndDownload()">â¬‡ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
  </div>
</header>

<div class="layout">
  <nav class="sidebar">
    <div class="sidebar-label">ã‚³ãƒ³ãƒ†ãƒ³ãƒ„</div>
    <button class="nav-item active" onclick="showPage('ba',this)"><span>â†”ï¸</span>BAã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼</button>
    <button class="nav-item" onclick="showPage('urls',this)"><span>ğŸ”—</span>URLè¨­å®š</button>
    <button class="nav-item" onclick="showPage('text',this)"><span>âœï¸</span>ãƒ†ã‚­ã‚¹ãƒˆ</button>
    <button class="nav-item" onclick="showPage('logos',this)"><span>ğŸ·</span>ãƒ­ã‚´</button>
    <button class="nav-item" onclick="showPage('profile',this)"><span>ğŸ‘¤</span>ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</button>
    <button class="nav-item" onclick="showPage('sections',this)"><span>âš™ï¸</span>ã‚»ã‚¯ã‚·ãƒ§ãƒ³è¨­å®š</button>
  </nav>

  <main class="main">

    <!-- ===== BA SLIDER ===== -->
    <div class="page active" id="page-ba">
      <div class="page-title">BAã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼</div>
      <div class="page-sub">æ–½å·¥äº‹ä¾‹ã®Before/Afterã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚’ç®¡ç†ã—ã¾ã™ã€‚è¿½åŠ ãƒ»å‰Šé™¤ãƒ»ä¸¦ã³æ›¿ãˆãŒå¯èƒ½ã§ã™ã€‚</div>
      <div id="ba-cards"></div>
      <button class="btn btn-add" onclick="addBaCard()">ï¼‹ ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚’è¿½åŠ ã™ã‚‹</button>
    </div>

    <!-- ===== URL ===== -->
    <div class="page" id="page-urls">
      <div class="page-title">URL è¨­å®š</div>
      <div class="page-sub">LINEãƒ»Instagramãƒ»å‹•ç”»ã®URLã‚’è¨­å®šã—ã¾ã™ã€‚</div>
      <div class="card">
        <div class="card-head"><span class="card-icon">ğŸ’¬</span><span class="card-name">LINE</span><span class="card-desc">ãƒ¡ã‚¤ãƒ³CTA</span></div>
        <div class="card-body">
          <div class="form-row"><label class="field-label">LINE URL</label><input type="url" id="line-url" placeholder="https://lin.ee/xxxxxxx" oninput="markDirty()"><div class="hint"><a href="https://manager.line.biz/" target="_blank">LINE Official Account Manager</a> â†’ å‹ã ã¡è¿½åŠ ã‚¬ã‚¤ãƒ‰</div></div>
          <div class="form-row"><label class="field-label">CTAãƒœã‚¿ãƒ³ã®ãƒ†ã‚­ã‚¹ãƒˆ</label><input type="text" id="line-btn-text" placeholder="LINE ã§ãŠå•ã„åˆã‚ã›" oninput="markDirty()"></div>
        </div>
      </div>
      <div class="card">
        <div class="card-head"><span class="card-icon">ğŸ“·</span><span class="card-name">Instagram</span></div>
        <div class="card-body">
          <div class="form-row"><label class="field-label">Instagram URL</label><input type="url" id="ig-url" placeholder="https://www.instagram.com/cementart_numan/" oninput="markDirty()"></div>
        </div>
      </div>
      <div class="card">
        <div class="card-head"><span class="card-icon">ğŸ¬</span><span class="card-name">å‹•ç”»</span><span class="card-desc">Cinematic View</span></div>
        <div class="card-body">
          <div class="form-row"><label class="field-label">å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«URLï¼ˆMP4ï¼‰</label><input type="url" id="video-url" placeholder="https://... ï¼ˆGitHubã®Raw URLãªã©ï¼‰" oninput="markDirty()"><div class="hint">GitHubã«å‹•ç”»ã‚’ã‚¢ãƒƒãƒ—ã—ã¦Raw URLã‚’ä½¿ã†ã®ãŒãŠã™ã™ã‚ã§ã™ã€‚</div></div>
          <div class="form-row"><label class="field-label">ã‚µãƒ ãƒã‚¤ãƒ«ç”»åƒURLï¼ˆä»»æ„ï¼‰</label><input type="url" id="video-poster" placeholder="https://..." oninput="markDirty()"></div>
          <div class="toggle-row">
            <div class="toggle-info"><div class="t-label">å‹•ç”»ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤ºã™ã‚‹</div><div class="t-desc">OFFã«ã™ã‚‹ã¨ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã”ã¨éè¡¨ç¤º</div></div>
            <label class="toggle"><input type="checkbox" id="video-visible" onchange="markDirty()"><span class="toggle-track"></span><span class="toggle-thumb"></span></label>
          </div>
        </div>
      </div>
    </div>

    <!-- ===== TEXT ===== -->
    <div class="page" id="page-text">
      <div class="page-title">ãƒ†ã‚­ã‚¹ãƒˆ ç·¨é›†</div>
      <div class="page-sub">ã‚­ãƒ£ãƒƒãƒã‚³ãƒ”ãƒ¼ãƒ»ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ»CTAã®ãƒ†ã‚­ã‚¹ãƒˆã‚’ç·¨é›†ã—ã¾ã™ã€‚</div>
      <div class="card">
        <div class="card-head"><span class="card-icon">ğŸ†</span><span class="card-name">Heroï¼ˆãƒˆãƒƒãƒ—ï¼‰</span></div>
        <div class="card-body">
          <div class="form-row"><label class="field-label">ãƒ¡ã‚¤ãƒ³ã‚­ãƒ£ãƒƒãƒã‚³ãƒ”ãƒ¼</label><textarea id="hero-catch" rows="3" oninput="markDirty()"></textarea><div class="hint">æ”¹è¡Œã¯ &lt;br&gt; ã‚’ä½¿ã„ã¾ã™ã€‚ä¾‹ï¼šæ–½å·¥ã®ç¾å ´ãŒã€&lt;br&gt;æœ€é«˜ã®ææ¡ˆæ›¸ã«ãªã‚‹ã€‚</div></div>
          <div class="form-row"><label class="field-label">ã‚µãƒ–ã‚³ãƒ”ãƒ¼</label><textarea id="hero-sub" rows="2" oninput="markDirty()"></textarea></div>
        </div>
      </div>
      <div class="card">
        <div class="card-head"><span class="card-icon">ğŸ’Œ</span><span class="card-name">ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒœãƒƒã‚¯ã‚¹</span></div>
        <div class="card-body">
          <div class="form-row"><label class="field-label">ãƒ¡ã‚¤ãƒ³ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</label><textarea id="msg-main" rows="3" oninput="markDirty()"></textarea><div class="hint">é‡‘è‰²ã«ã—ãŸã„éƒ¨åˆ†ã‚’ &lt;span&gt;ã€œ&lt;/span&gt; ã§å›²ã‚“ã§ãã ã•ã„ã€‚</div></div>
          <div class="form-row"><label class="field-label">ã‚µãƒ–ãƒ†ã‚­ã‚¹ãƒˆ</label><textarea id="msg-body" rows="3" oninput="markDirty()"></textarea></div>
        </div>
      </div>
      <div class="card">
        <div class="card-head"><span class="card-icon">ğŸ“£</span><span class="card-name">CTA</span></div>
        <div class="card-body">
          <div class="form-row"><label class="field-label">CTAã‚¿ã‚¤ãƒˆãƒ«</label><textarea id="cta-title" rows="2" oninput="markDirty()"></textarea></div>
        </div>
      </div>
    </div>

    <!-- ===== LOGOS ===== -->
    <div class="page" id="page-logos">
      <div class="page-title">ãƒ­ã‚´</div>
      <div class="page-sub">ãƒ•ãƒƒã‚¿ãƒ¼ãƒ»é€ã‹ã—ã«ä½¿ç”¨ã™ã‚‹ãƒ­ã‚´ç”»åƒã‚’è¨­å®šã—ã¾ã™ã€‚</div>
      <div class="card">
        <div class="card-head"><span class="card-icon">ğŸ·</span><span class="card-name">ãƒ­ã‚´ç”»åƒ</span></div>
        <div class="card-body">
          <div class="logo-grid">
            <div>
              <div class="img-drop-label">ãƒ€ãƒ¼ã‚¯ç”¨ãƒ­ã‚´</div>
              <div class="logo-drop" id="drop-fdark" onclick="triggerUpload('file-fdark')">
                <img class="preview" id="prev-fdark" src="images/footer_logo_dark.jpg" alt="">
                <div class="img-drop-overlay"><span class="img-drop-icon">ğŸ“·</span><span class="img-drop-text">ã‚¯ãƒªãƒƒã‚¯ã—ã¦å¤‰æ›´</span></div>
                <input type="file" id="file-fdark" accept="image/*" onchange="handleLogo(this,'footer-logo-dark','prev-fdark','drop-fdark')">
              </div>
            </div>
            <div>
              <div class="img-drop-label">ãƒ©ã‚¤ãƒˆç”¨ãƒ­ã‚´</div>
              <div class="logo-drop" id="drop-flight" onclick="triggerUpload('file-flight')">
                <img class="preview" id="prev-flight" src="images/footer_logo_light.jpg" alt="">
                <div class="img-drop-overlay"><span class="img-drop-icon">ğŸ“·</span><span class="img-drop-text">ã‚¯ãƒªãƒƒã‚¯ã—ã¦å¤‰æ›´</span></div>
                <input type="file" id="file-flight" accept="image/*" onchange="handleLogo(this,'footer-logo-light','prev-flight','drop-flight')">
              </div>
            </div>
            <div>
              <div class="img-drop-label">é€ã‹ã—ç”¨ï¼ˆPNGæ¨å¥¨ï¼‰</div>
              <div class="logo-drop" id="drop-logo" onclick="triggerUpload('file-logo')">
                <img class="preview" id="prev-logo" src="images/logo.png" alt="">
                <div class="img-drop-overlay"><span class="img-drop-icon">ğŸ“·</span><span class="img-drop-text">ã‚¯ãƒªãƒƒã‚¯ã—ã¦å¤‰æ›´</span></div>
                <input type="file" id="file-logo" accept="image/*" onchange="handleLogo(this,'logo','prev-logo','drop-logo')">
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ===== PROFILE ===== -->
    <div class="page" id="page-profile">
      <div class="page-title">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</div>
      <div class="page-sub">ã¬ãƒ¼ã¾ã‚“ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç·¨é›†ã—ã¾ã™ã€‚</div>
      <div class="card">
        <div class="card-head"><span class="card-icon">ğŸ‘¤</span><span class="card-name">åŸºæœ¬æƒ…å ±</span></div>
        <div class="card-body">
          <div class="form-grid form-row">
            <div><label class="field-label">åå‰ï¼ˆæ—¥æœ¬èªï¼‰</label><input type="text" id="numan-name-ja" placeholder="ã‚»ãƒ¡ãƒ³ãƒˆã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆ ã¬ãƒ¼ã¾ã‚“" oninput="markDirty()"></div>
            <div><label class="field-label">åå‰ï¼ˆè‹±èªï¼‰</label><input type="text" id="numan-name-en" placeholder="Cement Artist Nuâ˜†Man" oninput="markDirty()"></div>
          </div>
          <div class="form-grid form-row">
            <div><label class="field-label">ğŸ“ å ´æ‰€</label><input type="text" id="numan-location" placeholder="ä¸‰é‡çœŒ æ¾é˜ªå¸‚" oninput="markDirty()"></div>
            <div><label class="field-label">ğŸ—“ çµŒæ­´</label><input type="text" id="numan-career" placeholder="ãƒ­ãƒ¼ãƒ©ãƒ¼ã‚¹ãƒˆãƒ¼ãƒ³æ­´ 2019å¹´ã€œ" oninput="markDirty()"></div>
          </div>
        </div>
      </div>
      <div class="card">
        <div class="card-head"><span class="card-icon">ğŸ“–</span><span class="card-name">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æ–‡</span></div>
        <div class="card-body">
          <div class="form-row"><textarea id="numan-body" rows="10" oninput="markDirty()"></textarea></div>
        </div>
      </div>
      <div class="card">
        <div class="card-head"><span class="card-icon">ğŸ–¼</span><span class="card-name">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å†™çœŸ</span></div>
        <div class="card-body">
          <div style="display:grid;grid-template-columns:200px 160px;gap:16px;">
            <div>
              <div class="img-drop-label">ãƒ¡ã‚¤ãƒ³å†™çœŸï¼ˆã‚«ãƒ©ãƒ¼ï¼‰</div>
              <div class="logo-drop" style="aspect-ratio:1;" id="drop-nm" onclick="triggerUpload('file-nm')">
                <img class="preview" id="prev-nm" src="images/numan_color.jpg" alt="">
                <div class="img-drop-overlay"><span class="img-drop-icon">ğŸ“·</span><span class="img-drop-text">å¤‰æ›´</span></div>
                <input type="file" id="file-nm" accept="image/*" onchange="handleLogo(this,'numan-color','prev-nm','drop-nm')">
              </div>
            </div>
            <div>
              <div class="img-drop-label">ã‚µãƒ–å†™çœŸ</div>
              <div class="logo-drop" style="aspect-ratio:1;" id="drop-ns" onclick="triggerUpload('file-ns')">
                <img class="preview" id="prev-ns" src="images/numan_portrait.jpg" alt="">
                <div class="img-drop-overlay"><span class="img-drop-icon">ğŸ“·</span><span class="img-drop-text">å¤‰æ›´</span></div>
                <input type="file" id="file-ns" accept="image/*" onchange="handleLogo(this,'numan-portrait','prev-ns','drop-ns')">
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ===== SECTIONS ===== -->
    <div class="page" id="page-sections">
      <div class="page-title">ã‚»ã‚¯ã‚·ãƒ§ãƒ³è¨­å®š</div>
      <div class="page-sub">å„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®è¡¨ç¤ºãƒ»éè¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆã¾ã™ã€‚</div>
      <div class="card">
        <div class="card-body">
          <div class="toggle-row"><div class="toggle-info"><div class="t-label">BAã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³</div></div><label class="toggle"><input type="checkbox" id="sec-ba" checked onchange="markDirty()"><span class="toggle-track"></span><span class="toggle-thumb"></span></label></div>
          <div class="toggle-row"><div class="toggle-info"><div class="t-label">å‹•ç”»ã‚»ã‚¯ã‚·ãƒ§ãƒ³</div></div><label class="toggle"><input type="checkbox" id="sec-video" onchange="markDirty()"><span class="toggle-track"></span><span class="toggle-thumb"></span></label></div>
          <div class="toggle-row"><div class="toggle-info"><div class="t-label">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚»ã‚¯ã‚·ãƒ§ãƒ³</div></div><label class="toggle"><input type="checkbox" id="sec-profile" checked onchange="markDirty()"><span class="toggle-track"></span><span class="toggle-thumb"></span></label></div>
          <div class="toggle-row"><div class="toggle-info"><div class="t-label">Why KIMARUã‚»ã‚¯ã‚·ãƒ§ãƒ³</div></div><label class="toggle"><input type="checkbox" id="sec-why" checked onchange="markDirty()"><span class="toggle-track"></span><span class="toggle-thumb"></span></label></div>
        </div>
      </div>
    </div>

  </main>
</div>

<!-- SAVE BAR -->
<div class="save-bar" id="save-bar">
  <div class="save-msg">âš  <strong>æœªä¿å­˜ã®å¤‰æ›´ãŒã‚ã‚Šã¾ã™ã€‚</strong></div>
  <div class="save-btns">
    <button class="btn btn-secondary" onclick="resetAll()">ãƒªã‚»ãƒƒãƒˆ</button>
    <button class="btn btn-primary" onclick="generateAndDownload()">â¬‡ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
  </div>
</div>
<div class="toast" id="toast"><span style="color:var(--green)">âœ…</span><span id="toast-msg"></span></div>

<script>
// ===== STATE =====
var dirty=false;
var imageData={};// keyâ†’{base64,filename}
var baCards=[];// array of {id,title,before,after,finish,color,grout,sample}

// ===== NAV =====
function showPage(id,el){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
  document.getElementById('page-'+id).classList.add('active');
  el.classList.add('active');
}

// ===== DIRTY =====
function markDirty(){dirty=true;document.getElementById('save-bar').classList.add('show');}
function resetAll(){if(!confirm('å¤‰æ›´ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ'))return;dirty=false;document.getElementById('save-bar').classList.remove('show');loadDefaults();}

// ===== BA CARDS =====
var baIdCounter=0;

function addBaCard(data){
  if(!data)data={id:'ba_'+(baIdCounter++),title:'',before:'',after:'',finish:'',color:'',grout:'',sample:''};
  else if(!data.id)data.id='ba_'+(baIdCounter++);
  baCards.push(data);
  renderBaCards();
  markDirty();
}

function removeBaCard(id){
  baCards=baCards.filter(c=>c.id!==id);
  renderBaCards();
  markDirty();
}

function renderBaCards(){
  var container=document.getElementById('ba-cards');
  container.innerHTML='';
  baCards.forEach(function(item,i){
    var div=document.createElement('div');
    div.className='ba-card';
    div.id='card-'+item.id;
    div.innerHTML=buildBaCardHTML(item,i);
    container.appendChild(div);
    initBaPreview(item.id);
  });
}

function buildBaCardHTML(item,i){
  var num=(i+1<10?'0'+(i+1):''+(i+1));
  return '<div class="ba-card-head">'
    +'<span class="ba-card-num">'+num+'</span>'
    +'<input class="ba-card-title-input" type="text" placeholder="ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆä¾‹ï¼šRSã‚¿ã‚¤ãƒ«èª¿ ç„é–¢ã‚¢ãƒ—ãƒ­ãƒ¼ãƒï¼‰" value="'+escHtml(item.title)+'" oninput="updateBaField(\''+item.id+'\',\'title\',this.value)">'
    +'<button class="btn btn-danger" onclick="removeBaCard(\''+item.id+'\')">å‰Šé™¤</button>'
    +'</div>'
    +'<div class="ba-card-body">'
    // Preview
    +'<div class="ba-preview-panel">'
    +'<div class="ba-preview-slider" id="preview-slider-'+item.id+'">'
    +(item.before?'<img class="ba-preview-img" src="'+item.before+'" alt="">':'')
    +(item.after?'<img class="ba-preview-img ba-preview-after" id="prev-after-'+item.id+'" src="'+item.after+'" alt="">':'')
    +(item.before||item.after?'<div class="ba-preview-handle"><div class="ba-preview-line"></div><div class="ba-preview-pill">SLIDE</div></div>':'<div class="ba-preview-empty">ç”»åƒã‚’ã‚¢ãƒƒãƒ—ã™ã‚‹ã¨ã“ã“ã«ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</div>')
    +'</div>'
    +'</div>'
    // Upload areas
    +'<div class="ba-img-grid">'
    +'<div>'
    +'<div class="img-drop-label">Beforeï¼ˆæ–½å·¥å‰ï¼‰</div>'
    +'<div class="img-drop'+(item.before?' has-img':'')+'" id="drop-b-'+item.id+'" onclick="triggerUpload(\'file-b-'+item.id+'\')">'
    +(item.before?'<img class="preview" src="'+item.before+'" alt="">':'')
    +'<div class="img-drop-overlay"><span class="img-drop-icon">ğŸ“·</span><span class="img-drop-text">æ–½å·¥å‰ã®å†™çœŸ</span></div>'
    +'<input type="file" id="file-b-'+item.id+'" accept="image/*" onchange="handleBaImage(this,\''+item.id+'\',\'before\')">'
    +'</div>'
    +'<div class="img-fname" id="fn-b-'+item.id+'">'+(item.before&&item.before.startsWith('data:')?'ç”»åƒè¨­å®šæ¸ˆã¿':item.before?item.before:'æœªè¨­å®š')+'</div>'
    +'</div>'
    +'<div>'
    +'<div class="img-drop-label">Afterï¼ˆæ–½å·¥å¾Œï¼‰</div>'
    +'<div class="img-drop'+(item.after?' has-img':'')+'" id="drop-a-'+item.id+'" onclick="triggerUpload(\'file-a-'+item.id+'\')">'
    +(item.after?'<img class="preview" src="'+item.after+'" alt="">':'')
    +'<div class="img-drop-overlay"><span class="img-drop-icon">ğŸ“·</span><span class="img-drop-text">æ–½å·¥å¾Œã®å†™çœŸ</span></div>'
    +'<input type="file" id="file-a-'+item.id+'" accept="image/*" onchange="handleBaImage(this,\''+item.id+'\',\'after\')">'
    +'</div>'
    +'<div class="img-fname" id="fn-a-'+item.id+'">'+(item.after&&item.after.startsWith('data:')?'ç”»åƒè¨­å®šæ¸ˆã¿':item.after?item.after:'æœªè¨­å®š')+'</div>'
    +'</div>'
    +'</div>'
    // Info fields
    +'<div class="info-fields">'
    +'<div><label class="field-label">ä»•ä¸Šã’å</label><input type="text" placeholder="RSã‚¿ã‚¤ãƒ«èª¿" value="'+escHtml(item.finish)+'" oninput="updateBaField(\''+item.id+'\',\'finish\',this.value)"></div>'
    +'<div><label class="field-label">ã‚«ãƒ©ãƒ¼</label><input type="text" placeholder="ã‚°ãƒ¬ãƒ¼" value="'+escHtml(item.color)+'" oninput="updateBaField(\''+item.id+'\',\'color\',this.value)"></div>'
    +'<div><label class="field-label">ç›®åœ°</label><input type="text" placeholder="ãƒ–ãƒ©ãƒƒã‚¯" value="'+escHtml(item.grout)+'" oninput="updateBaField(\''+item.id+'\',\'grout\',this.value)"></div>'
    +'</div>'
    // Sample image
    +'<div class="sample-row">'
    +'<div>'
    +'<div class="img-drop-label" style="margin-bottom:6px;">ç´ æã‚µãƒ³ãƒ—ãƒ«ç”»åƒï¼ˆä»»æ„ï¼‰</div>'
    +'<div class="img-drop has-img" style="width:80px;height:80px;aspect-ratio:1;" id="drop-s-'+item.id+'" onclick="triggerUpload(\'file-s-'+item.id+'\')">'
    +(item.sample?'<img class="preview" src="'+item.sample+'" alt="">':'')
    +'<div class="img-drop-overlay"><span class="img-drop-icon" style="font-size:1.2rem;">ğŸ“·</span></div>'
    +'<input type="file" id="file-s-'+item.id+'" accept="image/*" onchange="handleBaImage(this,\''+item.id+'\',\'sample\')">'
    +'</div>'
    +'</div>'
    +'<div style="font-size:.72rem;color:var(--text2);line-height:2;">ã‚¯ãƒªãƒƒã‚¯ã§æ‹¡å¤§ã§ãã‚‹å°ã•ãªã‚µãƒ ãƒã‚¤ãƒ«ã¨ã—ã¦ã€<br>ä»•ä¸Šã’èª¬æ˜ã®æ¨ªã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</div>'
    +'</div>'
    +'</div>';
}

function escHtml(s){return (s||'').replace(/&/g,'&amp;').replace(/"/g,'&quot;').replace(/</g,'&lt;').replace(/>/g,'&gt;');}

function updateBaField(id,field,val){
  var item=baCards.find(c=>c.id===id);
  if(item){item[field]=val;markDirty();}
}

function handleBaImage(input,id,field){
  var file=input.files[0];if(!file)return;
  var reader=new FileReader();
  reader.onload=function(e){
    var b64=e.target.result;
    var item=baCards.find(c=>c.id===id);
    if(!item)return;
    item[field]=b64;
    markDirty();
    // Update preview in card
    var drop=document.getElementById('drop-'+field[0]+'-'+id);
    if(drop){
      drop.classList.add('has-img');
      var prev=drop.querySelector('img.preview');
      if(prev)prev.src=b64;
      else{var img=document.createElement('img');img.className='preview';img.src=b64;drop.insertBefore(img,drop.firstChild);}
    }
    var fn=document.getElementById('fn-'+field[0]+'-'+id);
    if(fn)fn.textContent='ç”»åƒè¨­å®šæ¸ˆã¿ï¼ˆ'+file.name+')';
    // Update slider preview
    if(field==='before'||field==='after'){
      var slider=document.getElementById('preview-slider-'+id);
      if(slider){
        // Rebuild preview
        var beforeSrc=item.before||'';
        var afterSrc=item.after||'';
        slider.innerHTML=(beforeSrc?'<img class="ba-preview-img" src="'+beforeSrc+'" alt="">':'')
          +(afterSrc?'<img class="ba-preview-img ba-preview-after" id="prev-after-'+id+'" src="'+afterSrc+'" alt="">':'')
          +((beforeSrc||afterSrc)?'<div class="ba-preview-handle"><div class="ba-preview-line"></div><div class="ba-preview-pill">SLIDE</div></div>':'<div class="ba-preview-empty">ç”»åƒã‚’ã‚¢ãƒƒãƒ—ã™ã‚‹ã¨ã“ã“ã«ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</div>');
        initBaPreview(id);
      }
    }
    if(field==='sample'){
      var sdrop=document.getElementById('drop-s-'+id);
      if(sdrop){
        var simg=sdrop.querySelector('img.preview');
        if(simg)simg.src=b64;
        else{var si=document.createElement('img');si.className='preview';si.src=b64;sdrop.insertBefore(si,sdrop.firstChild);}
      }
    }
  };
  reader.readAsDataURL(file);
}

function initBaPreview(id){
  var slider=document.getElementById('preview-slider-'+id);
  if(!slider)return;
  var afterImg=slider.querySelector('.ba-preview-after');
  if(!afterImg)return;
  var handle=slider.querySelector('.ba-preview-handle');
  var dragging=false;
  function update(clientX){
    var rect=slider.getBoundingClientRect();
    var pos=Math.max(0,Math.min(100,((clientX-rect.left)/rect.width)*100));
    afterImg.style.clipPath='inset(0 0 0 '+pos+'%)';
    if(handle){handle.style.left=pos+'%';handle.style.transform='translateX(-50%)';}
  }
  slider.addEventListener('mousedown',function(e){dragging=true;update(e.clientX);});
  window.addEventListener('mousemove',function(e){if(dragging)update(e.clientX);});
  window.addEventListener('mouseup',function(){dragging=false;});
  slider.addEventListener('touchstart',function(e){update(e.touches[0].clientX);},{passive:true});
  slider.addEventListener('touchmove',function(e){update(e.touches[0].clientX);},{passive:true});
}

// ===== LOGO UPLOAD =====
function triggerUpload(id){document.getElementById(id).click();}

function handleLogo(input,key,previewId,dropId){
  var file=input.files[0];if(!file)return;
  var reader=new FileReader();
  reader.onload=function(e){
    imageData[key]={base64:e.target.result,filename:file.name};
    var prev=document.getElementById(previewId);
    if(prev){prev.src=e.target.result;prev.style.display='block';}
    var drop=document.getElementById(dropId);
    if(drop)drop.classList.add('has-img');
    markDirty();
  };
  reader.readAsDataURL(file);
}

// ===== DEFAULTS =====
function loadDefaults(){
  var s={};
  try{s=JSON.parse(localStorage.getItem('kimaru-settings')||'{}');}catch(e){}
  setVal('line-url',s['line-url']||'https://lin.ee/xxxxxxx');
  setVal('line-btn-text',s['line-btn-text']||'LINE ã§ãŠå•ã„åˆã‚ã›');
  setVal('ig-url',s['ig-url']||'https://www.instagram.com/cementart_numan/');
  setVal('video-url',s['video-url']||'');
  setVal('video-poster',s['video-poster']||'');
  setCheck('video-visible',s['video-visible']||false);
  setVal('hero-catch',s['hero-catch']||'æ–½å·¥ã®ç¾å ´ãŒã€ãã®ã¾ã¾<br>æœ€é«˜ã®ææ¡ˆæ›¸ã«ãªã‚‹ã€‚');
  setVal('hero-sub',s['hero-sub']||'æ–½å·¥ã®ç¾å ´ãŒã€ãã®ã¾ã¾æœ€é«˜ã®ææ¡ˆæ›¸ã«ãªã‚‹ã€‚\nKIMARUãŒã€ã‚ãªãŸã®å–¶æ¥­ã‚’å¤‰ãˆã¾ã™ã€‚');
  setVal('msg-main',s['msg-main']||'ã‚µãƒ³ãƒ—ãƒ«ã‚’æŒã£ã¦è¡Œã£ã¦ã‚‚å¥‘ç´„ãŒå–ã‚Œãªã„ã€\nãã‚“ãªæ™‚ä»£ã¯<span>ã‚‚ã†çµ‚ã‚ã‚Š</span>ã«ã—ã¾ã›ã‚“ã‹ã€‚');
  setVal('msg-body',s['msg-body']||'æŠ€è¡“ã¯æœ¬ç‰©ãªã®ã«ã€ä¼ãˆæ–¹ãŒè¿½ã„ã¤ã„ã¦ã„ãªã„ã ã‘ã€‚\nKIMARUã‚’ä½¿ãˆã°ã€ãŠå®¢æ§˜ãŒè‡ªåˆ†ã§ã€Œæ±ºã‚ã‚‹ã€ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚');
  setVal('cta-title',s['cta-title']||'æ°—ã«ãªã£ãŸæ–¹ã¯ã€\nã¾ãšLINEã§è©±ã—ã¾ã—ã‚‡ã†ã€‚');
  setVal('numan-name-ja',s['numan-name-ja']||'ã‚»ãƒ¡ãƒ³ãƒˆã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆ\nã¬ãƒ¼ã¾ã‚“');
  setVal('numan-name-en',s['numan-name-en']||'Cement Artist Nuâ˜†Man');
  setVal('numan-location',s['numan-location']||'ä¸‰é‡çœŒ æ¾é˜ªå¸‚');
  setVal('numan-career',s['numan-career']||'ãƒ­ãƒ¼ãƒ©ãƒ¼ã‚¹ãƒˆãƒ¼ãƒ³æ­´ 2019å¹´ã€œ');
  setVal('numan-body',s['numan-body']||'16æ­³ã‹ã‚‰å»ºè¨­æ¥­ç•Œã«é£›ã³è¾¼ã¿ã€é•·å¹´ã«ã‚ãŸã£ã¦ä»®è¨­äº‹æ¥­ãƒ»ä¸‹è«‹ã‘ã®ä¸–ç•Œã§åƒã„ã¦ããŸã€‚\n\nã„ã¤ã—ã‹ã€ã€Œã‚«ã‚¿ãƒã«æ®‹ã‚‹ä»•äº‹ãŒã—ãŸã„ã€ã¨æ€ã†ã‚ˆã†ã«ãªã£ãŸã€‚\nãã‚“ãªã¨ãå‡ºä¼šã£ãŸã®ãŒã€ãƒ­ãƒ¼ãƒ©ãƒ¼ã‚¹ãƒˆãƒ¼ãƒ³ã€‚\n\nãŠå®¢ã•ã‚“ã®å–œã¶å£°ã€ç¬‘é¡”ã«ç›´æ¥ãµã‚Œã‚‰ã‚Œã‚‹ä»•äº‹ã€‚\nãã—ã¦ã€ã“ã®ä»•äº‹ã«çœŸå‰£ã«å‘ãåˆã†ç†±ã„æ€ã„ã‚’æŒã£ãŸä»²é–“ãŸã¡ã¨å®šæœŸçš„ã«ä¼šãˆã‚‹ç’°å¢ƒã€‚\nå‡ºä¼šã†ãŸã³ã«æ°—ã¥ããŒã‚ã‚Šã€å­¦ã³ãŒã‚ã‚‹ã€‚\n\nã“ã®ç´ æ™´ã‚‰ã—ã„ä»•äº‹ã‚’ã€ã‚‚ã£ã¨å¤šãã®äººã«çŸ¥ã£ã¦ã‚‚ã‚‰ã„ãŸã„ã€‚\né«˜ã„æŠ€è¡“ã‚’æŒã¤ä»²é–“ãŸã¡ã«ã€ã‚‚ã£ã¨è‡ªä¿¡ã‚’æŒã£ã¦è¼ã‘ã‚‹æ©Ÿä¼šã‚’å±Šã‘ãŸã„ã€‚\nãã—ã¦ã€ç§è‡ªèº«ã‚’è‚²ã¦ã¦ãã‚ŒãŸROLLER STONEã¨ã„ã†æ¥­ç•Œã«ã€ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§æ©è¿”ã—ãŒã—ãŸã„ã€‚\n\nãã‚ŒãŒã€KIMARUã®åŸç‚¹ã§ã™ã€‚');
  setCheck('sec-ba',s['sec-ba']!==false);
  setCheck('sec-video',s['sec-video']||false);
  setCheck('sec-profile',s['sec-profile']!==false);
  setCheck('sec-why',s['sec-why']!==false);
  // BA cards
  baCards=[];
  baIdCounter=0;
  var savedCards=s['ba-cards']||[];
  if(savedCards.length){savedCards.forEach(function(c){c.id='ba_'+(baIdCounter++);baCards.push(c);});renderBaCards();}
  else{renderBaCards();}// empty state
}

function setVal(id,val){var el=document.getElementById(id);if(el)el.value=val;}
function setCheck(id,val){var el=document.getElementById(id);if(el)el.checked=val;}
function getVal(id){var el=document.getElementById(id);return el?el.value:'';}
function getCheck(id){var el=document.getElementById(id);return el?el.checked:false;}

// ===== SAVE SETTINGS =====
function saveSettings(){
  var s={
    'line-url':getVal('line-url'),
    'line-btn-text':getVal('line-btn-text'),
    'ig-url':getVal('ig-url'),
    'video-url':getVal('video-url'),
    'video-poster':getVal('video-poster'),
    'video-visible':getCheck('video-visible'),
    'hero-catch':getVal('hero-catch'),
    'hero-sub':getVal('hero-sub'),
    'msg-main':getVal('msg-main'),
    'msg-body':getVal('msg-body'),
    'cta-title':getVal('cta-title'),
    'numan-name-ja':getVal('numan-name-ja'),
    'numan-name-en':getVal('numan-name-en'),
    'numan-location':getVal('numan-location'),
    'numan-career':getVal('numan-career'),
    'numan-body':getVal('numan-body'),
    'sec-ba':getCheck('sec-ba'),
    'sec-video':getCheck('sec-video'),
    'sec-profile':getCheck('sec-profile'),
    'sec-why':getCheck('sec-why'),
    'ba-cards':baCards,
  };
  try{localStorage.setItem('kimaru-settings',JSON.stringify(s));}catch(e){}
  return s;
}

// ===== GENERATE HTML =====
function generateAndDownload(){
  var s=saveSettings();
  fetch('kimaru_pr.html')
    .then(r=>{if(!r.ok)throw new Error();return r.text();})
    .then(html=>{
      html=applySettings(html,s);
      downloadHTML(html,'kimaru_pr.html');
      dirty=false;
      document.getElementById('save-bar').classList.remove('show');
      showToast('HTMLã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸï¼GitHubã«ã‚¢ãƒƒãƒ—ã—ã¦ãã ã•ã„ã€‚');
    })
    .catch(()=>showToast('âš  kimaru_pr.htmlãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚åŒã˜ãƒ•ã‚©ãƒ«ãƒ€ã«ç½®ã„ã¦ãã ã•ã„ã€‚'));
}

function applySettings(html,s){
  // BA data JSON
  var baJson=JSON.stringify(baCards.map(function(item){
    return {title:item.title,before:item.before||'',after:item.after||'',finish:item.finish||'',color:item.color||'',grout:item.grout||'',sample:item.sample||''};
  }));
  html=html.replace(/(<script type="application\/json" id="ba-data">)([\s\S]*?)(<\/script>)/,'$1'+baJson+'$3');

  // LINE URL
  html=html.replace(/href="[^"]*"(\s*class="cta-btn)/g,'href="'+s['line-url']+'"$1');
  // Instagram URL
  html=html.replace(/href="[^"]*"(\s*class="numan-ig)/g,'href="'+s['ig-url']+'"$1');
  // Video
  html=html.replace(/(<video[^>]*src=")[^"]*(")/,'$1'+s['video-url']+'$2');
  html=html.replace(/(<video[^>]*poster=")[^"]*(")/,'$1'+s['video-poster']+'$2');

  // Hero catch
  var catchLines=s['hero-catch'].split('\n').filter(l=>l.trim());
  if(catchLines.length){
    var newCatch=catchLines.map(l=>'<span>'+l+'</span>').join('');
    html=html.replace(/(<div class="hero-catch">)([\s\S]*?)(<\/div>[\s\n]*<\/div>[\s\n]*<p class="hero-sub">)/,function(m,p1,p2,p3){return p1+newCatch+p3.replace(/^(<\/div>[\s\n]*<\/div>[\s\n]*)/,'</div>\n    </div>\n    ');});
  }
  // Hero sub
  html=html.replace(/(<p class="hero-sub">)([\s\S]*?)(<\/p>)/,'$1'+s['hero-sub'].replace(/\n/g,'<br>')+'$3');
  // Message
  html=html.replace(/(<p class="message-main">)([\s\S]*?)(<\/p>)/,'$1'+s['msg-main'].replace(/\n/g,'<br>')+'$3');
  html=html.replace(/(<p class="message-body">)([\s\S]*?)(<\/p>)/,'$1'+s['msg-body'].replace(/\n/g,'<br>')+'$3');
  // CTA title
  html=html.replace(/(<h2 class="cta-title reveal">)([\s\S]*?)(<\/h2>)/,'$1'+s['cta-title'].replace(/\n/g,'<br>')+'$3');
  // Numan name
  html=html.replace(/(<h2 class="numan-name">)([\s\S]*?)(<\/h2>)/,'$1'+s['numan-name-ja'].replace(/\n/g,'<br>')+'$3');
  html=html.replace(/(<p class="numan-title">)([\s\S]*?)(<\/p>)/,'$1'+s['numan-name-en']+'$3');
  html=html.replace(/(<span class="numan-meta-text">ä¸‰é‡çœŒ[^<]*)(<\/span>)/,'<span class="numan-meta-text">'+s['numan-location']+'$2');
  html=html.replace(/(<span class="numan-meta-text">ãƒ­ãƒ¼ãƒ©ãƒ¼ã‚¹ãƒˆãƒ¼ãƒ³æ­´[^<]*)(<\/span>)/,'<span class="numan-meta-text">'+s['numan-career']+'$2');
  // Numan body
  var nbHtml=s['numan-body'].replace(/\n\n/g,'</p>\n<p class="numan-body reveal">').replace(/\n/g,'<br>');
  html=html.replace(/(<p class="numan-body reveal">)([\s\S]*?)(<\/p>\s*<a)/,'$1'+nbHtml+'$3');

  // Images (logo / numan photos)
  var imgMap={'numan-color':'images/numan_color.jpg','numan-portrait':'images/numan_portrait.jpg','footer-logo-dark':'images/footer_logo_dark.jpg','footer-logo-light':'images/footer_logo_light.jpg','logo':'images/logo.png'};
  Object.keys(imageData).forEach(function(key){
    if(!imgMap[key])return;
    var src=imgMap[key].replace(/\./g,'\\.').replace(/\//g,'\\/');
    html=html.replace(new RegExp('src="'+src+'"','g'),'src="'+imageData[key].base64+'"');
  });

  // Section visibility
  if(!s['sec-ba'])html=html.replace(/(id="ba-section"[^>]*>)([\s\S]*?)(<\/section>[\s\S]*?<!-- VIDEO)/,function(m,p1,p2,p3){return p1+'<div style="display:none">'+p2+'</div>'+p3;});
  if(!s['sec-video'])html=html.replace(/(class="[^"]*video-section[^"]*"[^>]*>)([\s\S]*?)(<\/section>[\s\S]*?<!-- MESSAGE)/,function(m,p1,p2,p3){return p1+'<div style="display:none">'+p2+'</div>'+p3;});
  if(!s['sec-profile'])html=html.replace(/(<!-- NUMAN SECTION -->)([\s\S]*?)(<!-- WHY)/, '$1<div style="display:none">$2</div>$3');
  if(!s['sec-why'])html=html.replace(/(<!-- WHY KIMARU STORY -->)([\s\S]*?)(<!-- CTA)/,'$1<div style="display:none">$2</div>$3');

  return html;
}

function downloadHTML(html,filename){
  var blob=new Blob([html],{type:'text/html;charset=utf-8'});
  var a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download=filename;a.click();URL.revokeObjectURL(a.href);
}

function previewLP(){
  var s=saveSettings();
  fetch('kimaru_pr.html')
    .then(r=>r.text())
    .then(html=>{var m=applySettings(html,s);var blob=new Blob([m],{type:'text/html'});window.open(URL.createObjectURL(blob),'_blank');})
    .catch(()=>showToast('âš  kimaru_pr.htmlãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚'));
}

function showToast(msg){
  var t=document.getElementById('toast');document.getElementById('toast-msg').textContent=msg;
  t.classList.add('show');setTimeout(()=>t.classList.remove('show'),3500);
}

// INIT
loadDefaults();
</script>
</body>
</html>
