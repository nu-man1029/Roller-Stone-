<!DOCTYPE html>
<html lang="ja">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-9KY5C7XC36"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-9KY5C7XC36');
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>工事請負契約書 作成システム</title>
    <script src="https://yubinbango.github.io/yubinbango/yubinbango.js" charset="UTF-8"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    
    <style>
        :root {
            --bg-dark: #0a0a0a;
            --rs-gold: #c5a059;
            --text-white: #ffffff;
            --text-gray: #aaaaaa;
            --border-gray: #333333;
        }

        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-white);
            margin: 0; padding: 0;
        }

        .container { max-width: 800px; margin: 0 auto; padding: 20px; }
        header { text-align: center; padding: 20px 0; border-bottom: 2px solid var(--rs-gold); margin-bottom: 20px; }
        h1 { font-size: 1.4rem; color: var(--rs-gold); margin: 0; }
        section { margin-bottom: 30px; }
        h2 { font-size: 1rem; border-left: 4px solid var(--rs-gold); padding-left: 15px; color: var(--rs-gold); margin-bottom: 15px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; font-size: 0.8rem; margin-bottom: 5px; color: var(--text-gray); }

        input[type="text"], input[type="number"], input[type="date"], textarea {
            width: 100%; padding: 10px; box-sizing: border-box;
            background-color: #222; border: 1px solid var(--border-gray);
            border-radius: 4px; color: #fff; font-size: 16px;
        }

        .btn-row { display: flex; gap: 10px; margin-top: 8px; }
        button.sub-btn { background: #333; color: #fff; border: none; padding: 8px 12px; cursor: pointer; border-radius: 4px; }

        .main-btn {
            display: block; width: 100%; padding: 18px;
            background: linear-gradient(135deg, #d4af37, #c5a059);
            color: #000; border: none; border-radius: 8px;
            font-size: 1.1rem; font-weight: bold; cursor: pointer; margin-top: 30px;
        }

        /* --- PDF用 A4固定レイアウト設定 --- */
        #preview-screen { display: none; background-color: #555; padding: 20px 0; }
        
        .page-container {
            background: #fff;
            width: 210mm;
            min-height: 297mm;
            margin: 0 auto;
            padding: 10mm; /* 余白を10mmに固定 */
            color: #000;
            box-sizing: border-box;
            font-family: "MS Mincho", "Hiragino Mincho ProN", serif;
            font-size: 10pt; /* 本文サイズ 10pt */
            line-height: 1.4; /* 行間 1.4 */
            position: relative;
        }

        /* PDF出力時の強制改ページ */
        .page-break-after { page-break-after: always; }

        .stamp-box {
            position: absolute; top: 10mm; right: 10mm;
            border: 1px solid #000; width: 25mm; height: 30mm;
            font-size: 8pt; display: flex; align-items: center; text-align: center; padding: 2px;
        }

        .paper-title { text-align: center; font-size: 18pt; font-weight: bold; margin: 10mm 0 15mm 0; text-decoration: underline; }
        .clause-title { font-weight: bold; margin-top: 10px; margin-bottom: 4px; font-size: 11pt; border-bottom: 0.5px solid #000; }
        .indent-1 { padding-left: 1.5em; text-indent: -1.5em; margin-bottom: 2px; }
        .indent-2 { padding-left: 2.5em; text-indent: -1.5em; margin-bottom: 1px; }

        .sign-area { margin-top: 20px; }
        .sign-row { margin-bottom: 12px; display: flex; border-bottom: 1px solid #000; padding-bottom: 2px; }
        .sign-label { width: 90px; }
        .sign-content { flex-grow: 1; }
        .in-mark { text-align: right; width: 40px; font-size: 12pt; }

        .preview-controls {
            position: sticky; top: 0; background: rgba(0,0,0,0.85); padding: 15px;
            display: flex; justify-content: center; gap: 20px; z-index: 1000;
        }

        @media print {
            body { background: none; }
            #preview-screen { padding: 0; }
            .preview-controls { display: none; }
            .page-container { box-shadow: none; margin: 0; }
        }
    </style>
</head>
<body>

<div id="input-screen" class="container">
    <header><h1>工事請負契約書 作成システム</h1></header>
    <form id="contract-form">
        <section>
            <h2>第1条：当事者情報</h2>
            <div class="h-adr">
                <span class="p-country-name" style="display:none;">Japan</span>
                <div class="form-group"><label>【甲】発注者 氏名 / 会社名</label><input type="text" id="ko_name" placeholder="例：佐藤 一郎 様" required></div>
                <div class="form-group"><label>【甲】郵便番号</label><input type="text" class="p-postal-code" placeholder="1234567"></div>
                <div class="form-group"><label>【甲】住所</label><input type="text" id="ko_addr" class="p-region p-locality p-street-address p-extended-address"></div>
            </div>
            <div class="h-adr" style="margin-top:20px;">
                <span class="p-country-name" style="display:none;">Japan</span>
                <div class="form-group"><label>【乙】施工者 氏名 / 会社名</label><input type="text" id="otsu_name" value="株式会社 ローラースタイル"></div>
                <div class="form-group"><label>【乙】住所</label><input type="text" id="otsu_addr" value="東京都中央区..."></div>
            </div>
        </section>

        <section>
            <h2>第2条：工事内容</h2>
            <div class="form-group"><label>工事名</label><input type="text" id="work_name" placeholder="例：佐藤様邸 外構リフォーム工事" required></div>
            <div class="form-group"><label>工事場所 住所</label><input type="text" id="work_place" placeholder="現場の住所"></div>
            <div class="form-group"><label>工事内容（概要）</label><textarea id="work_desc" rows="2" placeholder="例：駐車場ローラーストーン施工、門柱改修一式"></textarea></div>
        </section>

        <section>
            <h2>第3・4条：工期と金額</h2>
            <div class="form-group"><label>着工日</label><input type="date" id="date_start" required></div>
            <div class="form-group"><label>完成日</label><input type="date" id="date_end" required></div>
            <div class="form-group"><label>合計金額（税込）</label><input type="number" id="total_price" placeholder="1100000" required></div>
            <div class="form-group"><label>中間金 条件</label><input type="text" id="mid_term_cond" placeholder="例：下地完了"></div>
            <div class="form-group"><label>中間金 金額</label><input type="number" id="pay_mid"></div>
        </section>

        <button type="button" class="main-btn" onclick="showPreview()">契約内容を確認してPDF作成</button>
    </form>
</div>

<div id="preview-screen">
    <div class="preview-controls">
        <button class="sub-btn" onclick="backToEdit()">修正に戻る</button>
        <button class="sub-btn" onclick="generatePDF()" style="background: var(--rs-gold); color: #000; font-weight: bold;">PDFを保存する</button>
    </div>

    <div id="pdf-content">
        <div class="page-container page-break-after">
            <div class="stamp-box">印紙（請負額に応じた額）</div>
            <div class="paper-title">工事請負契約書</div>
            
            <div class="clause-title">第1条（当事者）</div>
            <div class="indent-1">本契約の当事者は、以下の発注者及び施工者とする。</div>
            <div>発注者（以下「甲」という。）</div>
            <div class="indent-1">　住所：<span id="p_ko_addr"></span></div>
            <div class="indent-1">　氏名：<span id="p_ko_name"></span></div>
            <div style="margin-top:5px;">施工者（以下「乙」という。）</div>
            <div class="indent-1">　住所：<span id="p_otsu_addr"></span></div>
            <div class="indent-1">　会社名／氏名：<span id="p_otsu_name"></span></div>

            <div class="clause-title">第2条（契約の目的および工事内容）</div>
            <div class="indent-1">1 甲は乙に対し、下記工事（以下「本工事」という。）の施工を請け負わせ、乙はこれを完成させて甲へ引き渡す。</div>
            <div class="indent-2">(1) 工事名：<span id="p_work_name"></span></div>
            <div class="indent-2">(2) 工事場所：<span id="p_work_place"></span></div>
            <div class="indent-2">(3) 工事内容（概要）：<span id="p_work_desc"></span></div>
            <div class="indent-1">2 本工事の具体的内容は設計図書等に従うものとする。</div>

            <div class="clause-title">第3条（工期）</div>
            <div class="indent-1">1 本工事の工期は以下のとおりとする。</div>
            <div class="indent-1">　着工日：<span id="p_date_start"></span> / 完成日：<span id="p_date_end"></span></div>

            <div class="clause-title">第4条（請負代金および支払方法）</div>
            <div class="indent-1">1 甲は乙に対し、請負代金として合計金 <span id="p_total_price"></span> 円（税込）を支払う。</div>
            <div class="indent-1">2 支払時期：中間金（<span id="p_mid_term_cond"></span>時）として <span id="p_pay_mid"></span> 円を支払う。</div>
        </div>

        <div class="page-container page-break-after">
            <div class="clause-title">第5条（材料の調達および危険負担）</div>
            <div class="indent-1">1 乙は材料を自己の責任で調達する。2 滅失等の危険は乙が負担する。</div>
            <div class="clause-title">第6条（現場管理および安全対策）</div>
            <div class="indent-1">1 乙は安全・品質管理を適切に行う。2 近隣への迷惑を防止する措置を講じる。</div>
            <div class="clause-title">第7条（検査および引渡し）</div>
            <div class="indent-1">1 乙は完成後通知し、2 甲は速やかに検査する。4 合格後引き渡す。</div>
            <div class="clause-title">第8条（契約不適合責任）</div>
            <div class="indent-1">1 引き渡しから1年以内に不適合が判明した場合、乙は補修等の責任を負う。</div>
            <div class="clause-title">第9条（追加・変更工事）</div>
            <div class="indent-1">1 変更時は乙が合理的な見積を作成し、甲の承認を得るものとする。</div>
            <div class="clause-title">第10条（損害賠償）</div>
            <div class="indent-1">1 違反により損害を与えた場合、賠償する。2 遅延損害金は年14.6%とする。</div>
            <div class="clause-title">第11条（解除）</div>
            <div class="indent-1">1 催告後、履行がない場合は解除できる。2 破産等の場合は無催告で解除できる。</div>
        </div>

        <div class="page-container">
            <div class="clause-title">第12条（不可抗力）</div>
            <div class="indent-1">天災地変その他乙の責めに帰さない事由による遅延は、乙はその責を負わない。</div>
            <div class="clause-title">第13条（秘密保持）</div>
            <div class="indent-1">本契約で知り得た情報を第三者に漏洩してはならない。</div>
            <div class="clause-title">第14条（権利義務の譲渡禁止）</div>
            <div class="indent-1">相手方の承諾なく、権利または義務を第三者に譲渡してはならない。</div>
            <div class="clause-title">第15条（協議）</div>
            <div class="indent-1">定めのない事項は甲乙誠意をもって協議解決する。</div>
            <div class="clause-title">第16条（合意管轄）</div>
            <div class="indent-1">本契約に関する紛争は、被告所在地の裁判所を管轄とする。</div>

            <div style="margin-top: 30mm;">
                以上の合意を証するため、本契約書を2通作成し、甲乙各1通ずつ保有する。
            </div>

            <div class="sign-area">
                <div>甲（発注者）</div>
                <div class="sign-row"><div class="sign-label">住所：</div><div class="sign-content"><span id="s_ko_addr"></span></div></div>
                <div class="sign-row"><div class="sign-label">氏名：</div><div class="sign-content"><span id="s_ko_name"></span></div><div class="in-mark">印</div></div>
                <div style="margin-top: 20px;">乙（施工者）</div>
                <div class="sign-row"><div class="sign-label">住所：</div><div class="sign-content"><span id="s_otsu_addr"></span></div></div>
                <div class="sign-row"><div class="sign-label">会社名／氏名：</div><div class="sign-content"><span id="s_otsu_name"></span></div><div class="in-mark">印</div></div>
            </div>
        </div>
    </div>
</div>

<script>
    function formatDateJP(dateStr) {
        if (!dateStr) return "令和　年　月　日";
        const d = new Date(dateStr);
        return `令和 ${d.getFullYear() - 2018} 年 ${d.getMonth() + 1} 月 ${d.getDate()} 日`;
    }

    function showPreview() {
        const fields = ['ko_name', 'ko_addr', 'otsu_name', 'otsu_addr', 'work_name', 'work_place', 'work_desc', 'mid_term_cond'];
        fields.forEach(f => {
            const val = document.getElementById(f).value;
            if(document.getElementById('p_'+f)) document.getElementById('p_'+f).innerText = val;
            if(document.getElementById('s_'+f)) document.getElementById('s_'+f).innerText = val;
        });

        document.getElementById('p_date_start').innerText = formatDateJP(document.getElementById('date_start').value);
        document.getElementById('p_date_end').innerText = formatDateJP(document.getElementById('date_end').value);
        
        const price = document.getElementById('total_price').value;
        const mid = document.getElementById('pay_mid').value;
        document.getElementById('p_total_price').innerText = price ? Number(price).toLocaleString() : "0";
        document.getElementById('p_pay_mid').innerText = mid ? Number(mid).toLocaleString() : "0";

        document.getElementById('input-screen').style.display = 'none';
        document.getElementById('preview-screen').style.display = 'block';
        window.scrollTo(0, 0);
    }

    function backToEdit() {
        document.getElementById('input-screen').style.display = 'block';
        document.getElementById('preview-screen').style.display = 'none';
    }

    async function generatePDF() {
        const element = document.getElementById('pdf-content');
        const opt = {
            margin: 0,
            filename: '工事請負契約書_' + document.getElementById('ko_name').value + '.pdf',
            image: { type: 'jpeg', quality: 0.98 },
            html2canvas: { scale: 2, useCORS: true },
            jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
        };
        await html2pdf().set(opt).from(element).save();
    }
</script>
</body>
</html>
