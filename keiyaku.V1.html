<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>工事請負契約書 自動生成アプリ | ROLLER STONE Style</title>
    <script src="https://yubinbango.github.io/yubinbango/yubinbango.js" charset="UTF-8"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        :root {
            --bg-dark: #0a0a0a;
            --form-bg: #1a1a1a;
            --input-bg: #222222;
            --rs-gold: #c5a059;
            --text-white: #ffffff;
            --text-gray: #aaaaaa;
            --border-gray: #333333;
        }

        body {
            font-family: 'Helvetica Neue', Arial, "Hiragino Kaku Gothic ProN", "Hiragino Sans", Meiryo, sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-white);
            margin: 0;
            padding: 0;
            line-height: 1.6;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 40px 0;
            border-bottom: 2px solid var(--rs-gold);
            margin-bottom: 30px;
        }

        h1 {
            font-size: 1.5rem;
            letter-spacing: 2px;
            color: var(--rs-gold);
            margin: 0;
        }

        /* フォームデザイン */
        section {
            margin-bottom: 40px;
        }

        h2 {
            font-size: 1.1rem;
            border-left: 4px solid var(--rs-gold);
            padding-left: 15px;
            margin-bottom: 20px;
            color: var(--rs-gold);
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            font-size: 0.85rem;
            margin-bottom: 8px;
            color: var(--text-gray);
        }

        input[type="text"],
        input[type="number"],
        input[type="date"],
        textarea {
            width: 100%;
            padding: 12px;
            box-sizing: border-box;
            background-color: var(--input-bg);
            border: 1px solid var(--border-gray);
            border-radius: 4px;
            color: var(--text-white);
            font-size: 16px; /* iOSズーム防止 */
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        input:focus, textarea:focus {
            outline: none;
            border-color: var(--rs-gold);
            box-shadow: 0 0 8px rgba(197, 160, 89, 0.4);
        }

        .btn-row {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        button.sub-btn {
            background: #333;
            color: #fff;
            border: none;
            padding: 8px 15px;
            font-size: 0.8rem;
            cursor: pointer;
            border-radius: 4px;
        }

        /* メインアクションボタン */
        .main-btn {
            display: block;
            width: 100%;
            padding: 20px;
            background: linear-gradient(135deg, #d4af37, #c5a059);
            color: #000;
            border: none;
            border-radius: 8px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            margin-top: 40px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .main-btn:active {
            transform: translateY(2px);
        }

        /* プレビュー画面 */
        #preview-screen {
            display: none;
            background-color: #f4f4f4;
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }

        #contract-paper {
            background: #fff;
            width: 210mm; /* A4 width */
            margin: 0 auto;
            padding: 20mm;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            font-family: "MS Mincho", "Hiragino Mincho ProN", serif;
            box-sizing: border-box;
            font-size: 11pt;
        }

        .paper-title { text-align: center; font-size: 18pt; margin-bottom: 30px; border-bottom: 2px solid #000; padding-bottom: 10px; }
        .clause-title { font-weight: bold; margin-top: 15px; }
        .indent { padding-left: 1.5em; }
        
        .preview-controls {
            position: sticky;
            top: 0;
            background: rgba(10, 10, 10, 0.9);
            padding: 15px;
            display: flex;
            justify-content: center;
            gap: 20px;
            z-index: 100;
        }

        @media screen and (max-width: 850px) {
            #contract-paper { width: 100%; padding: 10mm; }
        }

        /* ユーティリティ */
        .hidden { display: none !important; }
    </style>
</head>
<body>

<div id="input-screen" class="container">
    <header>
        <h1>CONSTRUCTION CONTRACT GENERATOR</h1>
    </header>

    <form id="contract-form" class="h-adr">
        <span class="p-country-name" style="display:none;">Japan</span>
        
        <section>
            <h2>第1条：当事者情報</h2>
            <div class="form-group">
                <label>【甲】発注者 氏名 / 会社名</label>
                <input type="text" id="ko_name" placeholder="例：佐藤 一郎 様" required>
            </div>
            <div class="form-group">
                <label>【甲】郵便番号 (住所自動入力)</label>
                <input type="text" class="p-postal-code" size="8" maxlength="8" placeholder="123-4567">
            </div>
            <div class="form-group">
                <label>【甲】住所</label>
                <input type="text" id="ko_addr" class="p-region p-locality p-street-address p-extended-address" placeholder="自動入力されます">
            </div>

            <hr style="border-color: #333; margin: 30px 0;">

            <div class="form-group">
                <label>【乙】施工者 氏名 / 会社名</label>
                <input type="text" id="otsu_name" placeholder="例：株式会社ローラースタイル">
            </div>
            <div class="form-group">
                <label>【乙】住所</label>
                <input type="text" id="otsu_addr" placeholder="施工者の住所を入力">
            </div>
            <button type="button" class="sub-btn" onclick="saveOtsuInfo()">乙の情報を保存する</button>
        </section>

        <section>
            <h2>第2条：工事内容</h2>
            <div class="form-group">
                <label>工事名</label>
                <input type="text" id="work_name" placeholder="例：佐藤様邸 外構リフォーム工事" required>
            </div>
            <div class="form-group">
                <label>工事場所</label>
                <div class="btn-row">
                    <input type="text" id="work_place" placeholder="工事現場の住所">
                    <button type="button" class="sub-btn" onclick="copyKoAddr()">甲の住所をコピー</button>
                </div>
            </div>
            <div class="form-group">
                <label>工事内容（概要）</label>
                <textarea id="work_desc" rows="3" placeholder="例：駐車場 ローラーストーン施工 一式"></textarea>
            </div>
        </section>

        <section>
            <h2>第3条：工期</h2>
            <div class="form-group">
                <label>着工日</label>
                <input type="date" id="date_start" required>
            </div>
            <div class="form-group">
                <label>完成日</label>
                <input type="date" id="date_end" required>
            </div>
            <div class="form-group">
                <label>引渡日</label>
                <input type="date" id="date_delivery" required>
            </div>
        </section>

        <section>
            <h2>第4条：金額・支払</h2>
            <div class="form-group">
                <label>請負代金（税込）</label>
                <input type="number" id="total_price" placeholder="1,100,000" required>
            </div>
            <div class="form-group">
                <label>契約締結時 金額</label>
                <input type="number" id="pay_sign" placeholder="300,000">
            </div>
            <div class="form-group">
                <label>中間金 条件（例：下地完了時）</label>
                <input type="text" id="mid_term_cond" placeholder="下地工事完了時">
            </div>
            <div class="form-group">
                <label>中間金 金額</label>
                <input type="number" id="pay_mid" placeholder="400,000">
            </div>
            <div class="form-group">
                <label>引渡時 金額</label>
                <input type="number" id="pay_end" placeholder="400,000">
            </div>
        </section>

        <button type="button" class="main-btn" onclick="showPreview()">契約内容を確認する</button>
    </form>
</div>

<div id="preview-screen">
    <div class="preview-controls">
        <button class="sub-btn" onclick="backToEdit()" style="background: #555; padding: 10px 25px;">修正する</button>
        <button class="sub-btn" onclick="generatePDF()" style="background: var(--rs-gold); color: #000; font-weight: bold; padding: 10px 25px;">PDF保存 / 印刷</button>
    </div>

    <div id="contract-paper">
        <div class="paper-title">工事請負契約書</div>
        
        <div class="clause-title">第１条（当事者）</div>
        <div>本契約の当事者は、以下の発注者及び施工者とする。</div>
        <div>発注者（以下「甲」という。）</div>
        <div class="indent">住　　所：<span id="p_ko_addr"></span></div>
        <div class="indent">会社名／氏名：<span id="p_ko_name"></span></div>
        <div>施工者（以下「乙」という。）</div>
        <div class="indent">住　　所：<span id="p_otsu_addr"></span></div>
        <div class="indent">会社名／氏名：<span id="p_otsu_name"></span></div>

        <div class="clause-title">第２条（契約の目的および工事内容）</div>
        <div>１　甲は乙に対し、下記工事（以下「本工事」という。）の施工を請け負わせ、乙はこれを完成させて甲へ引き渡す。</div>
        <div class="indent">（１）工事名：<span id="p_work_name"></span></div>
        <div class="indent">（２）工事場所：<span id="p_work_place"></span></div>
        <div class="indent">（３）工事内容（概要）：<span id="p_work_desc"></span></div>
        <div>２　本工事の具体的内容・仕様・施工範囲は、本契約書に添付する見積書、図面、仕様書、工程表、現場指示書その他これに準ずる資料（以下「設計図書等」という。）に従うものとする。</div>
        <div>３　設計図書等に不明確な点がある場合、甲乙協議の上決定し、必要に応じて文書にて確認する。</div>

        <div class="clause-title">第３条（工期）</div>
        <div>１　本工事の工期は以下のとおりとする。</div>
        <div class="indent">着工日：<span id="p_date_start"></span></div>
        <div class="indent">完成日：<span id="p_date_end"></span></div>
        <div class="indent">引渡日：<span id="p_date_delivery"></span></div>
        <div>２　天災地変、法令変更、近隣トラブルその他乙の責めに帰さない事由により工期遅延が見込まれる場合、乙は遅滞なく甲へ通知し、甲乙協議のうえ工期を変更する。</div>
        <div>３　乙の責めに帰すべき事由により工期が遅延した場合、その遅延により甲が被った損害を乙は賠償する。</div>

        <div class="clause-title">第４条（請負代金および支払方法）</div>
        <div>１　甲は乙に対し、請負代金として合計 金 <span id="p_total_price"></span> 円（税込）を支払う。</div>
        <div>２　支払時期および割合は以下とする。</div>
        <div class="indent">（１）契約締結時：<span id="p_pay_sign"></span> 円</div>
        <div class="indent">（２）中間金（<span id="p_mid_term_cond"></span> についての工事完了時）：<span id="p_pay_mid"></span> 円</div>
        <div class="indent">（３）引渡時：<span id="p_pay_end"></span> 円</div>
        <div>３　甲が支払期日までに代金を支払わなかった場合、甲は支払期日の翌日から完済に至るまで年１４．６％の割合による遅延損害金を乙に支払う。</div>

        <div style="font-size: 9pt; margin-top: 20px; color: #666;">（中略：第5条〜第15条の規定は標準約款に準ずる）</div>
        <div id="full-clauses" style="font-size: 9pt;">
            </div>

        <div style="margin-top: 50px;">
            以上の合意を証するため、本契約書の正本２通を作成し、甲乙各１通ずつ保有する。
        </div>

        <div style="margin-top: 30px;">
            <div style="margin-bottom: 20px;">
                甲（発注者）<br>
                住所：<span id="s_ko_addr"></span><br>
                氏名：<span id="s_ko_name"></span>　　　　印
            </div>
            <div>
                乙（施工者）<br>
                住所：<span id="s_otsu_addr"></span><br>
                氏名：<span id="s_otsu_name"></span>　　　　印
            </div>
        </div>
    </div>
</div>

<script>
    // ページロード時に保存された乙の情報を復元
    window.onload = function() {
        const savedOtsu = JSON.parse(localStorage.getItem('otsu_info'));
        if (savedOtsu) {
            document.getElementById('otsu_name').value = savedOtsu.name || '';
            document.getElementById('otsu_addr').value = savedOtsu.addr || '';
        }
    };

    function saveOtsuInfo() {
        const info = {
            name: document.getElementById('otsu_name').value,
            addr: document.getElementById('otsu_addr').value
        };
        localStorage.setItem('otsu_info', JSON.stringify(info));
        alert('施工者情報を保存しました。');
    }

    function copyKoAddr() {
        document.getElementById('work_place').value = document.getElementById('ko_addr').value;
    }

    function formatDateJP(dateStr) {
        if (!dateStr) return "　　年　月　日";
        const date = new Date(dateStr);
        const year = date.getFullYear();
        const month = date.getMonth() + 1;
        const day = date.getDate();
        // 令和計算
        const reiwa = year - 2018;
        return `令和 ${reiwa} 年 ${month} 月 ${day} 日`;
    }

    function formatPrice(num) {
        return num ? Number(num).toLocaleString() : "0";
    }

    function showPreview() {
        // 入力値の取得
        const data = {
            ko_name: document.getElementById('ko_name').value,
            ko_addr: document.getElementById('ko_addr').value,
            otsu_name: document.getElementById('otsu_name').value,
            otsu_addr: document.getElementById('otsu_addr').value,
            work_name: document.getElementById('work_name').value,
            work_place: document.getElementById('work_place').value,
            work_desc: document.getElementById('work_desc').value,
            date_start: formatDateJP(document.getElementById('date_start').value),
            date_end: formatDateJP(document.getElementById('date_end').value),
            date_delivery: formatDateJP(document.getElementById('date_delivery').value),
            total_price: formatPrice(document.getElementById('total_price').value),
            pay_sign: formatPrice(document.getElementById('pay_sign').value),
            pay_mid: formatPrice(document.getElementById('pay_mid').value),
            pay_end: formatPrice(document.getElementById('pay_end').value),
            mid_term_cond: document.getElementById('mid_term_cond').value || "---"
        };

        // プレビューへの反映
        for (let key in data) {
            const el = document.getElementById('p_' + key);
            if (el) el.innerText = data[key];
            const sel = document.getElementById('s_' + key);
            if (sel) sel.innerText = data[key];
        }

        // 第5条〜第16条の流し込み（簡略化のためここに追加）
        const restClauses = `
            <div class="clause-title">第５条（材料の調達および危険負担）</div>
            <div>１ 乙は、本工事に必要な材料を自己の責任と費用負担にて調達する。２ 乙が持ち込んだ材料が完成前に滅失または損傷した場合、その原因が甲の責めに帰すべきを除き、その危険は乙が負担する。</div>
            <div class="clause-title">第６条（現場管理および安全対策）</div>
            <div>１ 乙は、本工事の施工に際し、安全管理・品質管理・労務管理を適切に行い、法令・条例及び行政指導に従うものとする。２ 乙は、騒音・振動・粉塵等により近隣に迷惑が生じないよう必要な措置を講じるものとする。</div>
            <div class="clause-title">第７条（検査および引渡し）</div>
            <div>１ 乙は本工事完成後、速やかに甲へ通知するものとする。２ 甲は前項の通知を受けた後、１週間以内に完成検査を行う。３ 検査の結果、是正を合理的に要する事項がある場合、乙は無償で補修し、再検査を受ける。４ 検査合格後、乙は本工事を甲へ引き渡すものとする。</div>
            <div class="clause-title">第８条（契約不適合責任）</div>
            <div>１ 乙が、種類又は品質に関して契約の内容に適合しない仕事の目的物を甲に引き渡したときは、甲が乙に対し引き渡しから１年以内にその旨を通知した場合に限り、乙は、民法の定めるところに従って、履行の追完（補修）又は報酬の減額等の契約不適合責任を負うものとする。２ 乙は、経年劣化、天災、第三者の行為、又は不適切な使用により仕事の目的物に生じた損傷について、契約不適合責任を負わない。</div>
            <div class="clause-title">第９条（追加・変更工事）</div>
            <div>１ 甲の指示又は現場状況により追加・変更工事が必要となった場合、乙は速やかに見積書を作成し、追加・変更工事代金額及び支払時期につき甲の承認を得るものとする。</div>
            <div class="clause-title">第１６条（合意管轄）</div>
            <div>本契約に関する紛争については、被告となる当事者の所在地を管轄する地方裁判所又は簡易裁判所を第一審の専属的合意管轄裁判所とする。</div>
        `;
        document.getElementById('full-clauses').innerHTML = restClauses;

        document.getElementById('input-screen').style.display = 'none';
        document.getElementById('preview-screen').style.display = 'block';
        window.scrollTo(0, 0);
    }

    function backToEdit() {
        document.getElementById('input-screen').style.display = 'block';
        document.getElementById('preview-screen').style.display = 'none';
    }

    function generatePDF() {
        const element = document.getElementById('contract-paper');
        const opt = {
            margin: [10, 10],
            filename: '工事請負契約書_' + document.getElementById('ko_name').value + '.pdf',
            image: { type: 'jpeg', quality: 0.98 },
            html2canvas: { scale: 2 },
            jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
        };
        html2pdf().set(opt).from(element).save();
    }
</script>

</body>
</html>
